<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THE PIT – Speaking Mode</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Orbitron',sans-serif;
  background:radial-gradient(circle,#bae6fd 0%,#0ea5e9 55%,#082f49 100%);
  color:#111827;
}

.speakingContainer{
  width:92%;
  max-width:1100px;
  margin:34px auto 120px auto;
  background:white;
  padding:32px;
  border-radius:25px;
  box-shadow:0 25px 50px rgba(0,0,0,0.55);
}

.speakingTitle{
  text-align:center;
  font-size:30px;
  color:#0c4a6e;
  margin:0 0 8px 0;
  letter-spacing:2px;
}

.subTitle{
  text-align:center;
  margin:0 0 18px 0;
  font-size:14px;
  color:#0369a1;
}

.topRow{
  display:flex;
  gap:10px;
  justify-content:space-between;
  flex-wrap:wrap;
  margin-bottom:14px;
}

.pill{
  padding:8px 12px;
  border-radius:999px;
  background:#e0f2fe;
  border:1px solid #38bdf8;
  font-weight:800;
  font-size:13px;
}

.switchBtn,.startBtn{
  padding:12px 16px;
  border-radius:14px;
  font-weight:900;
  cursor:pointer;
  transition:.2s;
  font-family:'Orbitron',sans-serif;
}

.switchBtn{
  border:2px solid #38bdf8;
  background:white;
  color:#0c4a6e;
}

.startBtn{
  border:none;
  background:#0ea5e9;
  color:white;
}

.hudRow{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:12px;
}

.hudBox{
  padding:10px 16px;
  border-radius:12px;
  font-weight:900;
  border:2px solid #38bdf8;
  background:#f0f9ff;
  color:#0c4a6e;
}

.tipBox{
  background:#f0f9ff;
  border:2px solid #38bdf8;
  border-radius:14px;
  padding:12px 14px;
  font-size:14px;
  margin-bottom:16px;
}

.progressTrack{
  width:100%;
  height:18px;
  background:#e5e7eb;
  border-radius:12px;
  overflow:hidden;
  margin-bottom:18px;
}

.progressFill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#0ea5e9,#22d3ee);
  transition:.3s;
}

.dialogueGrid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
  gap:14px;
}

.dialogueCard{
  background:#f0f9ff;
  border:2px solid #38bdf8;
  border-radius:18px;
  padding:14px;
}

.dialogueMeta{
  font-size:12px;
  color:#0369a1;
  margin-bottom:8px;
  font-weight:800;
}

.roleBox{
  background:white;
  border:1px solid #38bdf8;
  border-radius:10px;
  padding:8px;
  margin:6px 0;
  font-size:13px;
  line-height:1.35;
}

.botLine{
  margin-top:8px;
  background:#0c4a6e;
  color:white;
  border-radius:12px;
  padding:10px;
  min-height:42px;
  font-size:13px;
}

.smallNote{
  font-size:11px;
  color:#0369a1;
  margin-top:8px;
}

.fixed-bar{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#0c4a6e;
  border-top:2px solid #082f49;
  padding:10px;
  display:flex;
  justify-content:center;
  gap:12px;
  z-index:9999;
}

.bar-btn{
  background:#bae6fd;
  border:none;
  border-radius:10px;
  color:#0c4a6e;
  padding:10px 14px;
  font-weight:900;
  cursor:pointer;
  font-family:'Orbitron',sans-serif;
}
</style>
</head>
<body>

<div class="speakingContainer">
  <h1 class="speakingTitle">SPEAKING STREAK MODE</h1>
  <div class="subTitle">Student = Role A • Chatbot = Role B</div>

  <div class="topRow">
    <div class="pill" id="dialogueCountPill">DIALOGUES: 16</div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <button class="switchBtn" onclick="location.href='../index.html'">MAIN MENU</button>
      <button class="switchBtn" onclick="toggleTimer()">PAUSE / RESUME</button>
      <button class="startBtn" onclick="resetPractice()">RESET PRACTICE</button>
    </div>
  </div>

  <div class="hudRow">
    <div class="hudBox">SCORE: <span id="score">0</span></div>
    <div class="hudBox">TIME: <span id="timer">00:00</span></div>
    <div class="hudBox">COMPLETED: <span id="completed">0</span>/16</div>
  </div>

  <div class="tipBox"><strong>Tip:</strong> <span id="tip-text">Read your Role A line first, then click Talk to me.</span></div>

  <div class="progressTrack"><div class="progressFill" id="progress-bar"></div></div>

  <div id="dialogueGrid" class="dialogueGrid"></div>
</div>

<div class="fixed-bar">
  <button class="bar-btn" onclick="location.href='../index.html'">MAIN MENU</button>
  <button class="bar-btn" onclick="toggleTimer()">PAUSE / RESUME</button>
  <button class="bar-btn" onclick="resetPractice()">RESET</button>
</div>

<script>
const dialogues = [
{unit:'Unit 1 – Identity & Daily Life', focus:'Present Simple', title:'New in Class', lines:[['A','Hi, I\'m Daniel. I\'m new here.'],['B','Hi Daniel! I\'m Sara. Where are you from?'],['A','I\'m from Seville.'],['B','Nice! What do you usually do after school?'],['A','I usually play basketball and study in the evening.'],['B','That\'s cool. Are you good at sports?'],['A','Yes, I am. But I don\'t like Maths very much.'],['B','Don\'t worry. I can help you with that.']]},
{unit:'Unit 1 – Identity & Daily Life', focus:'Present Simple', title:'Daily Routine', lines:[['A','What time do you wake up?'],['B','I wake up at seven. What about you?'],['A','I wake up at half past seven.'],['B','Do you have breakfast at home?'],['A','Yes, I do. I usually eat toast and fruit.'],['B','I never have time for breakfast!']]},
{unit:'Unit 2 – School Life', focus:'Present Continuous', title:'Right Now', lines:[['A','What are you doing?'],['B','I\'m finishing my Science project.'],['A','Are you working alone?'],['B','No, I\'m working with Marta.'],['A','The teacher is explaining something now.'],['B','Oh no! We\'re not listening!']]},
{unit:'Unit 2 – School Life', focus:'Present Continuous', title:'In the Classroom', lines:[['A','Why are you laughing?'],['B','Because Leo is telling a joke.'],['A','Is the teacher watching?'],['B','Yes, she is. She\'s looking at us right now!'],['A','We\'re in trouble…']]},
{unit:'Unit 3 – Technology', focus:'Past Simple', title:'Online Problem', lines:[['A','You look upset. What happened?'],['B','I posted the wrong photo yesterday.'],['A','Really? Did many people see it?'],['B','Yes, they did. Everyone commented.'],['A','Did you delete it?'],['B','Yes, but it was too late.']]},
{unit:'Unit 3 – Technology', focus:'Past Simple', title:'Weekend Gaming', lines:[['A','What did you do last night?'],['B','I played video games for three hours.'],['A','Wow! Did you win?'],['B','No, I didn\'t. I lost every match!'],['A','That\'s unlucky.']]},
{unit:'Unit 4 – Future Plans', focus:'Will / Going to', title:'Weekend Plans', lines:[['A','What are you going to do this weekend?'],['B','I\'m going to visit my grandparents.'],['A','That sounds nice.'],['B','What about you?'],['A','I think I\'ll stay at home and study.'],['B','Don\'t worry. You\'ll do great on the exam.']]},
{unit:'Unit 4 – Future Plans', focus:'Will / Going to', title:'Predictions', lines:[['A','Look at those clouds.'],['B','Yes, it will rain soon.'],['A','Are you going to bring an umbrella?'],['B','No, I\'ll just run home!']]},
{unit:'Unit 5 – Health', focus:'Health', title:'At the Doctor', lines:[['A','What\'s the matter?'],['B','I have a terrible headache.'],['A','How long have you had it?'],['B','Since yesterday.'],['A','You should rest and drink water.'],['B','Okay, I will.']]},
{unit:'Unit 5 – Health', focus:'Health Habits', title:'Healthy Habits', lines:[['A','Do you eat vegetables every day?'],['B','Not really. I prefer fast food.'],['A','That\'s not healthy.'],['B','I know. I\'m going to change my diet.']]},
{unit:'Unit 6 – Travel', focus:'Directions', title:'Asking for Directions', lines:[['A','Excuse me, how do I get to the museum?'],['B','Go straight ahead and turn left.'],['A','Is it far?'],['B','No, it\'s five minutes from here.'],['A','Thank you very much.'],['B','You\'re welcome!']]},
{unit:'Unit 6 – Travel', focus:'Airport', title:'At the Airport', lines:[['A','Where are you flying?'],['B','I\'m flying to London.'],['A','Is it your first time there?'],['B','Yes, I\'m very excited.']]},
{unit:'Unit 7 – Environment', focus:'Eco Ideas', title:'Eco Ideas', lines:[['A','We should recycle more at school.'],['B','That\'s a good idea.'],['A','If we recycle paper, we will save trees.'],['B','And we can use less plastic.']]},
{unit:'Unit 7 – Environment', focus:'Climate', title:'Climate Talk', lines:[['A','Do you think climate change is serious?'],['B','Yes, it is.'],['A','What can we do?'],['B','We can use bikes instead of cars.']]},
{unit:'Unit 8 – Entertainment', focus:'Movies', title:'Movie Recommendation', lines:[['A','Have you seen the new superhero film?'],['B','No, is it good?'],['A','Yes, it\'s amazing!'],['B','What\'s it about?'],['A','It\'s about a teenager who saves the city.'],['B','I\'ll watch it tonight.']]},
{unit:'Unit 8 – Entertainment', focus:'Music', title:'Music Taste', lines:[['A','What kind of music do you like?'],['B','I like pop and hip-hop.'],['A','Really? I prefer rock.'],['B','That\'s interesting. We\'re very different!']]}
];

let score = 0;
let time = 0;
let timerInterval = null;
let paused = false;
const state = {};

function setProgress(percent){
  document.getElementById('progress-bar').style.width = percent + '%';
}

function setTip(text){
  document.getElementById('tip-text').textContent = text;
}

function updateCompletedCount(){
  document.getElementById('completed').textContent = Object.keys(state).length;
}

function startTimer(){
  if(timerInterval) return;
  timerInterval = setInterval(()=>{
    if(paused) return;
    time++;
    const m = String(Math.floor(time/60)).padStart(2,'0');
    const s = String(time%60).padStart(2,'0');
    document.getElementById('timer').textContent = `${m}:${s}`;
  },1000);
}

function toggleTimer(){
  paused = !paused;
  setTip(paused ? 'Timer paused.' : 'Timer resumed. Keep speaking!');
}

function renderDialogues(){
  const grid = document.getElementById('dialogueGrid');
  grid.innerHTML = dialogues.map((d,i)=>{
    const aLines = d.lines.filter(x=>x[0]==='A').map(x=>`<div class="roleBox">A: ${x[1]}</div>`).join('');
    return `<div class="dialogueCard">
      <h3>${d.title}</h3>
      <div class="dialogueMeta">${d.unit} • Focus: ${d.focus}</div>
      ${aLines}
      <button class="startBtn" onclick="talkToMe(${i})">TALK TO ME</button>
      <div class="botLine" id="bot-line-${i}">Bot (Role B): Click Talk to me to start.</div>
      <div class="smallNote">Say your A line first, then listen/respond.</div>
    </div>`;
  }).join('');
}

function talkToMe(index){
  startTimer();
  if(!(index in state)) state[index]=0;
  const bLines = dialogues[index].lines.filter(x=>x[0]==='B').map(x=>x[1]);
  if(!bLines.length) return;

  const line = bLines[state[index] % bLines.length];
  document.getElementById(`bot-line-${index}`).textContent = `Bot (Role B): ${line}`;
  state[index]++;

  score += 5;
  document.getElementById('score').textContent = score;
  updateCompletedCount();

  const progress = Math.min(Object.keys(state).length / dialogues.length * 100, 100);
  setProgress(progress.toFixed(0));
  setTip('Great! Continue by saying your next Role A line out loud.');

  if('speechSynthesis' in window){
    const msg = new SpeechSynthesisUtterance(line);
    msg.rate = 0.95;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(msg);
  }
}

function resetPractice(){
  score = 0;
  time = 0;
  paused = false;
  for(const k in state) delete state[k];
  document.getElementById('score').textContent = '0';
  document.getElementById('timer').textContent = '00:00';
  setProgress(0);
  updateCompletedCount();
  setTip('Practice reset. Read Role A, then click Talk to me.');
  renderDialogues();
}

renderDialogues();
</script>

</body>
</html>
