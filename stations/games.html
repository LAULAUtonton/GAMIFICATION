<!DOCTYPE html>
<html lang="en">
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Vocabulary Station</title>

<style>

/* DARK METAL GRAY BACKGROUND + WHITE TEXT */
body {
    background: linear-gradient(135deg, #2b2b2b, #1f1f1f, #2a2a2a);
    color: white;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
}

/* UNIVERSAL ACTIVITY COLORS */
.ordering-theme { background: #00B0FF20; border-left: 6px solid #00B0FF; }
.matching-theme { background: #AB47BC20; border-left: 6px solid #AB47BC; }
.trivia-theme { background: #4CAF5020; border-left: 6px solid #4CAF50; }
.fill-theme { background: #EF535020; border-left: 6px solid #EF5350; }
.builder-theme { background: #FDD83520; border-left: 6px solid #FDD835; }
.listen-theme { background: #FFA72620; border-left: 6px solid #FFA726; }
.read-theme { background: #5C6BC020; border-left: 6px solid #5C6BC0; }
.speak-theme { background: #26C6DA20; border-left: 6px solid #26C6DA; }

/* FIXED BOTTOM BAR ‚Äî PURPLE */
.fixed-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #6A1B9A;
    padding: 12px;
    display: flex;
    justify-content: center;
    gap: 20px;
    z-index: 9999;
    border-top: 2px solid #4A0072;
    backdrop-filter: blur(6px);
}

/* YELLOW BUTTONS */
.bar-btn {
    background: #FFEB3B;
    color: #1A1A1A;
    padding: 10px 20px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    font-size: 16px;
}
.bar-btn:hover { background: #FBC02D; color: black; }

/* GENERAL LAYOUT */
.screen {
    display: none;
    padding: 30px;
    margin-bottom: 100px;
    border-radius: 12px;
}
#main {
    padding: 30px;
    margin-bottom: 100px;
}
button {
    padding: 12px 20px;
    margin: 10px;
    border-radius: 10px;
    border: none;
    background: #4FC3F7;
    cursor: pointer;
    font-size: 18px;
    color: black;
}
button:hover { background: #0288D1; color: white; }

/* ========================= */
/* UNIVERSAL HUD CSS */
/* ========================= */

#progress-container {
    width: 100%;
    height: 12px;
    background: #444;
    border-bottom: 2px solid #222;
}
#progress-bar {
    width: 0%;
    height: 100%;
    background: #FFEB3B;
    transition: width 0.4s ease;
}

#hud-row {
    display: flex;
    gap: 10px;
    padding: 10px 20px;
}

#score-box {
    padding: 10px 20px;
    font-size: 20px;
    background: #6A1B9A;
    border-radius: 10px;
}

#timer-box {
    padding: 10px 20px;
    font-size: 20px;
    background: #AB47BC;
    border-radius: 10px;
}

#tip-box {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #333;
    padding: 15px 20px;
    border-radius: 10px;
    border: 2px solid #FFEB3B;
    font-size: 16px;
    max-width: 250px;
    color: white;
    z-index: 9999;
}

</style>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>THE PIT ‚Äì Games Station</title>
  <title>THE PIT ‚Äì Men√∫ de Juegos</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
  <style>
    :root{--bg1:#dbeafe;--bg2:#2563eb;--bg3:#0b1a44;--ink:#0f172a;--panel:#f8fafc;--line:#bfdbfe;--brand:#1d4ed8;--ok:#166534;--bad:#991b1b}
    *{box-sizing:border-box}
    body{margin:0;font-family:'Orbitron',sans-serif;background:radial-gradient(circle,var(--bg1) 0%,var(--bg2) 56%,var(--bg3) 100%);color:var(--ink)}
    .app{width:min(1120px,95vw);margin:14px auto 92px;background:#fff;border-radius:20px;padding:14px;box-shadow:0 18px 42px rgba(2,6,23,.45)}
    h1{margin:0;text-align:center;color:#1e3a8a;font-size:clamp(20px,4vw,30px)}
    .sub{margin:6px 0 10px;text-align:center;color:var(--brand);font-size:12px}

    .hud{display:grid;grid-template-columns:repeat(4,minmax(120px,1fr));gap:8px;margin-bottom:10px}
    .box{background:#eff6ff;border:2px solid #93c5fd;border-radius:10px;padding:9px;font-size:12px;font-weight:800;color:#1e3a8a}
    .tip{background:#ecfeff;border:2px solid #67e8f9;border-radius:10px;padding:10px;font-size:12px;color:#0f766e;margin-bottom:10px}

    .gameMenu{display:grid;grid-template-columns:repeat(4,minmax(150px,1fr));gap:8px;margin-bottom:10px}
    .gameBtn{border:2px solid var(--line);background:#fff;color:#1e3a8a;border-radius:10px;padding:10px;font-family:inherit;font-size:11px;font-weight:800;cursor:pointer;text-align:left}
    .gameBtn.active{background:#dbeafe;border-color:#2563eb}

    .panel{display:none;background:var(--panel);border:2px solid #cbd5e1;border-radius:12px;padding:12px}
    .panel.active{display:block}
    .panel h2{margin:0 0 8px;color:#1e3a8a;font-size:15px}
    .question{font-size:13px;margin:6px 0 8px}
    .answers{display:grid;gap:8px}
    .answers button{border:2px solid var(--line);background:#fff;color:#1e3a8a;border-radius:10px;padding:10px;font-family:inherit;font-size:11px;font-weight:800;text-align:left;cursor:pointer}
    .answers button:disabled{opacity:.85;cursor:not-allowed}
    .answers button.correct{background:#dcfce7;border-color:#22c55e;color:var(--ok)}
    .answers button.wrong{background:#fee2e2;border-color:#ef4444;color:var(--bad)}
    .feedback{min-height:18px;margin-top:8px;font-size:12px;font-weight:800}
    .ok{color:var(--ok)} .bad{color:var(--bad)}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .btn{border:0;border-radius:10px;padding:9px 12px;font-family:inherit;font-size:11px;font-weight:900;cursor:pointer}
    .primary{background:#2563eb;color:#fff}
    .soft{background:#e2e8f0;color:#0f172a}

    .pairsBoard{display:grid;grid-template-columns:repeat(4,minmax(66px,1fr));gap:8px}
    .pairCard{height:62px;border:2px solid var(--line);background:#dbeafe;border-radius:10px;font-family:inherit;font-size:11px;font-weight:800;color:#1e3a8a;cursor:pointer}
    .pairCard.open,.pairCard.matched{background:#fff}
    .pairCard.matched{border-color:#22c55e;color:#166534}

    .wheelCard{background:#eff6ff;border:2px dashed #93c5fd;border-radius:10px;padding:12px;font-size:12px;font-weight:800;color:#1e3a8a;min-height:54px}

    .anagramWord{font-size:13px;font-weight:900;color:#1e3a8a;margin:6px 0}
    .anagramInput{width:100%;border:2px solid var(--line);border-radius:10px;padding:10px;font-family:inherit;font-size:12px}

    .fixed{position:fixed;left:0;right:0;bottom:0;background:#0f172a;border-top:2px solid #1e293b;padding:8px;display:flex;justify-content:center;gap:8px;flex-wrap:wrap;z-index:20}
    .fixed button{border:0;border-radius:10px;padding:8px 10px;background:#dbeafe;color:#1e3a8a;font-family:inherit;font-size:11px;font-weight:900;cursor:pointer}

    @media (max-width:900px){.gameMenu{grid-template-columns:repeat(2,minmax(140px,1fr))}}
    @media (max-width:680px){
      .app{padding:10px;margin:8px auto 84px}
      .hud{grid-template-columns:repeat(2,minmax(120px,1fr))}
      .box,.tip{font-size:11px}
      .question{font-size:12px}
      .answers button,.gameBtn,.btn,.fixed button{font-size:10px}
      .pairsBoard{grid-template-columns:repeat(4,minmax(56px,1fr));gap:6px}
      .pairCard{height:56px;font-size:10px}
    body{
      margin:0;
      font-family:'Orbitron',sans-serif;
      background:radial-gradient(circle,#bae6fd 0%,#0ea5e9 55%,#082f49 100%);
      color:#0f172a;
    }
    .stationContainer{
      width:min(1120px, calc(100vw - 24px));
      margin:14px auto;
      background:#fff;
      border-radius:24px;
      padding:24px;
      box-shadow:0 25px 60px rgba(0,0,0,.45);
    }
    h1{margin:0 0 8px;text-align:center;color:#0c4a6e;letter-spacing:2px}
    .sub{text-align:center;margin:0 0 18px;color:#0369a1;font-size:13px}
    .screen{display:none}.screen.active{display:block}

    .menuGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
    .gameCard{
      border:2px solid #38bdf8;
      border-radius:18px;
      background:#f0f9ff;
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .gameCard h3{margin:0;color:#0c4a6e}
    .gameCard p{margin:0;font-size:12px;line-height:1.5;color:#075985}

    .btn{border:none;border-radius:12px;padding:11px 14px;font-weight:900;cursor:pointer;font-family:'Orbitron',sans-serif}
    .startBtn{background:#0ea5e9;color:#fff}
    .ghostBtn{background:#fff;border:2px solid #7dd3fc;color:#0c4a6e}

    .infoBar{background:#e0f2fe;border:2px solid #7dd3fc;border-radius:12px;padding:10px 12px;margin:0 0 10px;font-size:12px;color:#0c4a6e}
    .hud{display:flex;gap:8px;flex-wrap:wrap;margin:0 0 10px}
    .pill{background:#e0f2fe;border:2px solid #7dd3fc;border-radius:10px;padding:8px 10px;font-size:11px;font-weight:900;color:#0c4a6e}

    .gameWrap{display:grid;grid-template-columns:minmax(0,1fr) 290px;gap:12px}
    .board{
      background:#000;
      border:2px solid #0ea5e9;
      border-radius:16px;
      padding:8px;
      display:grid;
      grid-template-columns:repeat(8,1fr);
      gap:3px;
      min-height:430px;
    }
    .cell{
      height:48px;
      border-radius:8px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      color:#fff;
      font-size:12px;
      font-weight:700;
      text-align:center;
      line-height:1.1;
      padding:2px;
      border:1px solid rgba(14,165,233,.15);
      background:rgba(14,165,233,.03);
    }
    .word{color:#fff;background:rgba(255,255,255,.05);border-color:rgba(255,255,255,.25)}
    .pac::before{
      content:"";
      width:30px;
      height:30px;
      background:#1d4ed8;
      border-radius:50%;
      clip-path:polygon(50% 50%,100% 22%,100% 78%);
      transform:rotate(var(--r,0deg));
      position:absolute;
    }
    .ghost::before{
      content:"";
      width:28px;
      height:30px;
      background:#facc15;
      border-radius:14px 14px 7px 7px;
      position:absolute;
      box-shadow:inset 0 -4px 0 0 #f59e0b;
    }
    .ghost::after{
      content:"‚Ä¢ ‚Ä¢";
      color:#111827;
      font-size:12px;
      letter-spacing:2px;
      position:absolute;
      top:13px;
    }
  </style>
</head>

<body>

<!-- ========================= -->
<!-- UNIVERSAL HUD BLOCK -->
<!-- ========================= -->

<div id="progress-container">
    <div id="progress-bar"></div>
</div>

<div id="hud-row">
    <div id="score-box">Score: <span id="score">0</span></div>
    <div id="timer-box">Time: <span id="timer">00:00</span></div>
</div>

<div id="tip-box">
    <strong>Tip:</strong> <span id="tip-text">Choose an activity to begin!</span>
</div>

<!-- ========================= -->
<!-- END HUD BLOCK -->
<!-- ========================= -->

<!-- FIXED BOTTOM BAR -->
<div class="fixed-bar">
    <button class="bar-btn" onclick="goBack()">Back</button>
    <button class="bar-btn" onclick="location.href='../index.html'">Main Menu</button>
    <button class="bar-btn" onclick="alert('Paused')">Pause</button>
</div>

<!-- MAIN MENU -->
<div id="main">
    <h1>Vocabulary Station</h1>
    <button onclick="openScreen('matching')">Matching</button>
    <button onclick="openScreen('ordering')">Ordering</button>
    <button onclick="openScreen('fill')">Fill in the Blanks</button>
</div>

<!-- MATCHING -->
<div id="matching" class="screen matching-theme">
    <h2>Matching Activity</h2>
    <p>Match the words with their definitions.</p>
</div>

<!-- ORDERING -->
<div id="ordering" class="screen ordering-theme">
    <h2>Ordering Activity</h2>
    <p>Put the words in the correct order.</p>
</div>

<!-- FILL IN THE BLANKS -->
<div id="fill" class="screen fill-theme">
    <h2>Fill in the Blanks</h2>
    <p>Complete the sentences with the correct words.</p>
</div>
  <main class="app">
    <h1>GAMES STATION</h1>
    <p class="sub">Visible working apps: Quiz ‚Ä¢ Matching Pairs ‚Ä¢ Spin Wheel ‚Ä¢ Anagram</p>

    <section class="hud">
      <div class="box">SCORE: <span id="score">0</span></div>
      <div class="box">STARS: <span id="stars">0</span></div>
      <div class="box">TIME: <span id="timer">00:00</span></div>
      <div class="box">BEST APP: <span id="best">-</span></div>
    </section>

    <div class="tip"><strong>Tip:</strong> <span id="tip">Open any app and play. Each app gives points and stars.</span></div>

    <section class="gameMenu" id="gameMenu">
      <button class="gameBtn active" data-panel="quiz">üìù Quiz App<br><small>3-question skill check</small></button>
      <button class="gameBtn" data-panel="pairs">üÉè Matching Pairs App<br><small>memory + vocabulary</small></button>
      <button class="gameBtn" data-panel="wheel">üéØ Spin Wheel App<br><small>random speaking/writing tasks</small></button>
      <button class="gameBtn" data-panel="anagram">üî§ Anagram App<br><small>unscramble words</small></button>
    </section>
    .side{background:#f0f9ff;border:2px solid #7dd3fc;border-radius:14px;padding:10px}
    .order{display:flex;flex-wrap:wrap;gap:6px;margin:8px 0}
    .chip{padding:4px 8px;border:1px solid #7dd3fc;border-radius:999px;font-size:10px;background:#fff;color:#0369a1}
    .chip.done{background:#dcfce7;border-color:#86efac;color:#166534}
    .feedback{min-height:24px;font-size:11px;font-weight:800}
    .ok{color:#166534}.bad{color:#991b1b}

    <section id="panel-quiz" class="panel active">
      <h2>Quiz App</h2>
      <p id="quizQuestion" class="question"></p>
      <div id="quizAnswers" class="answers"></div>
      <div id="quizFeedback" class="feedback"></div>
      <div class="row">
        <button class="btn primary" id="quizNext" disabled>Next Question</button>
        <button class="btn soft" id="quizRestart">Restart Quiz</button>
      </div>
    </section>
    .controls{display:grid;grid-template-columns:repeat(3,1fr);gap:5px;max-width:180px;margin-top:8px}
    .controls .btn{padding:7px 10px}
    .blank{visibility:hidden}

    <section id="panel-pairs" class="panel">
      <h2>Matching Pairs App</h2>
      <div id="pairsBoard" class="pairsBoard"></div>
      <div id="pairsFeedback" class="feedback"></div>
      <div class="row">
        <button class="btn soft" id="pairsRestart">Restart Pairs</button>
    @media (max-width:860px){.gameWrap{grid-template-columns:1fr}.board{min-height:360px}}
    @media (max-width:560px){.stationContainer{padding:14px}.cell{height:40px;font-size:10px}}
  </style>
</head>
<body>
  <main class="stationContainer">
    <h1>THE PIT ¬∑ MEN√ö DE JUEGOS</h1>
    <p class="sub">El alumno primero elige un juego. Luego el sistema asigna autom√°ticamente la habilidad adecuada.</p>

    <section id="menuScreen" class="screen active">
      <div class="menuGrid">
        <article class="gameCard">
          <h3>üü¶ Comecocos Cl√°sico</h3>
          <p>Juego activo. Fondo negro, palabras blancas, Pacman azul y monstruo amarillo.</p>
          <button id="openGameBtn" class="btn startBtn">Elegir juego</button>
        </article>
        <article class="gameCard">
          <h3>üöß Pr√≥ximamente</h3>
          <p>Otros juegos del men√∫ se activar√°n despu√©s. Ahora se trabaja una experiencia clara y funcional.</p>
          <button class="btn ghostBtn" disabled>Bloqueado</button>
        </article>
      </div>
    </section>

    <section id="panel-wheel" class="panel">
      <h2>Spin Wheel App</h2>
      <div id="wheelResult" class="wheelCard">Press SPIN to get a challenge.</div>
      <div id="wheelFeedback" class="feedback"></div>
      <div class="row">
        <button class="btn primary" id="wheelSpin">SPIN</button>
    <section id="gameScreen" class="screen">
      <div id="assignInfo" class="infoBar"></div>
      <div class="hud">
        <div class="pill">Tiempo: <span id="timer">00:00</span></div>
        <div class="pill">Vidas: <span id="lives">3</span></div>
        <div class="pill">Siguiente palabra: <span id="nextWord">-</span></div>
      </div>
    </section>

    <section id="panel-anagram" class="panel">
      <h2>Anagram App</h2>
      <p class="question">Unscramble this word:</p>
      <div id="anagramWord" class="anagramWord">-</div>
      <input id="anagramInput" class="anagramInput" placeholder="Type your answer" />
      <div id="anagramFeedback" class="feedback"></div>
      <div class="row">
        <button class="btn primary" id="anagramCheck">Check</button>
        <button class="btn soft" id="anagramNext">Next Anagram</button>
      <div class="infoBar">Instrucciones: mueve al Comecocos con flechas (teclado o botones). Debes comer las palabras en el orden correcto de la frase.</div>

      <div class="gameWrap">
        <div id="board" class="board"></div>
        <aside class="side">
          <strong>Orden correcto</strong>
          <div id="orderChips" class="order"></div>
          <div id="feedback" class="feedback"></div>

          <div class="controls">
            <span class="blank">.</span><button class="btn ghostBtn" data-dir="up">‚Üë</button><span class="blank">.</span>
            <button class="btn ghostBtn" data-dir="left">‚Üê</button><button class="btn ghostBtn" data-dir="down">‚Üì</button><button class="btn ghostBtn" data-dir="right">‚Üí</button>
          </div>

          <div style="display:flex;gap:6px;margin-top:10px;flex-wrap:wrap">
            <button id="restartBtn" class="btn ghostBtn">Reiniciar</button>
            <button id="backBtn" class="btn ghostBtn">Volver al men√∫</button>
          </div>
        </aside>
      </div>
    </section>
  </main>

  <div class="fixed">
    <button onclick="location.href='../index.html'">Main Menu</button>
    <button id="pauseBtn">Pause/Resume Timer</button>
    <button id="resetBtn">Reset Score</button>
  </div>

<script>

/* SCREEN NAVIGATION */
function openScreen(id) {
    document.querySelectorAll('.screen, #main').forEach(s => s.style.display = 'none');
    document.getElementById(id).style.display = 'block';

    setTip("Complete the activity to earn points!");
    startTimer();
    setProgress(20);
}

function goBack() {
    document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
    document.getElementById('main').style.display = 'block';

    stopTimer();
    setTip("Choose an activity to begin!");
    setProgress(0);
}

/* ========================= */
/* UNIVERSAL HUD JS */
/* ========================= */

function setProgress(percent) {
    document.getElementById("progress-bar").style.width = percent + "%";
}

let score = 0;
function addScore(points) {
    score += points;
    document.getElementById("score").textContent = score;
}

let time = 0;
let timerInterval;

function startTimer() {
    stopTimer();
    time = 0;
    timerInterval = setInterval(() => {
        time++;
        let minutes = String(Math.floor(time / 60)).padStart(2, '0');
        let seconds = String(time % 60).padStart(2, '0');
        document.getElementById("timer").textContent = `${minutes}:${seconds}`;
    }, 1000);
}

function stopTimer() {
    clearInterval(timerInterval);
}

function setTip(text) {
    document.getElementById("tip-text").textContent = text;
}
  const sentence = ['I','always','do','my','homework','at','night'];
  const size = 8;
  const skillsByGame = {
    comecocos: ['Word Order', 'Grammar']
  };

  const state = {
    score: 0,
    stars: 0,
    best: '-',
    seconds: 0,
    paused: false,
    timerRef: null,
    quizIndex: 0,
    quizCorrect: 0,
    quizAnswered: false,
    pairsDeck: [],
    pairsOpen: [],
    anagramIndex: 0
    pac:{x:0,y:0,dir:'right'},
    ghost:{x:7,y:7},
    words:[],
    eaten:0,
    lives:3,
    seconds:0,
    timerRef:null,
    ghostRef:null,
    running:false
  };

  const saved = JSON.parse(localStorage.getItem('pitGamesV4') || '{}');
  state.score = saved.score || 0;
  state.stars = saved.stars || 0;
  state.best = saved.best || '-';

  const quizData = [
    {q:'Choose the correct sentence.', options:['She go to school.','She goes to school.','She going school.','She gone school.'], correct:1},
    {q:'Past simple of "eat" is...', options:['eat','eaten','ate','eated'], correct:2},
    {q:'Best contrast connector is...', options:['because','although','and','so'], correct:1}
  ];

  const pairBase = ['big|huge','small|tiny','start|begin','quick|fast'];

  const wheelTasks = [
    'Say one sentence in present simple about your daily routine.',
    'Write one sentence using because and one using although.',
    'Ask for directions politely in English.',
    'Give one prediction about tomorrow using will.',
    'Say 3 healthy habits using should.'
  ];

  const anagrams = [
    {scrambled:'LEAPP', answer:'APPLE'},
    {scrambled:'RYECCL', answer:'RECYCLE'},
    {scrambled:'MOREHOKW', answer:'HOMEWORK'},
    {scrambled:'TACOHB', answer:'CHATBOT'}
  ];

  function persist(){
    localStorage.setItem('pitGamesV4', JSON.stringify({score:state.score, stars:state.stars, best:state.best}));
  function setScreen(id){
    document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function hud(){
    document.getElementById('score').textContent = state.score;
    document.getElementById('stars').textContent = state.stars;
    document.getElementById('best').textContent = state.best;
  function updateAssignInfo(){
    const chosenSkill = skillsByGame.comecocos[Math.floor(Math.random()*skillsByGame.comecocos.length)];
    document.getElementById('assignInfo').textContent = `Juego elegido: Comecocos Cl√°sico ¬∑ Skill asignada autom√°ticamente: ${chosenSkill}`;
  }

  function tip(text){
    document.getElementById('tip').textContent = text;
  }
  function setupGame(){
    state.pac = {x:0,y:0,dir:'right'};
    state.ghost = {x:size-1,y:size-1};
    state.eaten = 0;
    state.lives = 3;
    state.seconds = 0;
    state.running = true;

    const fixedSlots = [
      {x:1,y:1},{x:3,y:1},{x:5,y:1},{x:6,y:2},{x:5,y:3},{x:3,y:3},{x:1,y:3}
    ];
    state.words = sentence.map((word, i) => ({ word, x:fixedSlots[i].x, y:fixedSlots[i].y, eaten:false }));

    drawOrder();
    renderBoard();
    updateHUD();
    setFeedback('Empieza el juego: come la primera palabra correcta.', 'ok');

    clearInterval(state.timerRef);
    state.timerRef = setInterval(() => {
      if(!state.running) return;
      state.seconds++;
      updateHUD();
    }, 1000);

  function addScore(points, app){
    state.score += points;
    if(app) state.best = app;
    hud();
    persist();
    clearInterval(state.ghostRef);
    state.ghostRef = setInterval(() => {
      if(!state.running) return;
      moveGhost();
      checkCollision();
      renderBoard();
    }, 850);
  }

  function addStar(app){
    state.stars += 1;
    state.best = app;
    hud();
    persist();
  function drawOrder(){
    document.getElementById('orderChips').innerHTML = sentence
      .map((w,i)=>`<span class="chip ${i<state.eaten?'done':''}">${i+1}. ${w}</span>`)
      .join('');
  }

  function startTimer(){
    if(state.timerRef) return;
    state.timerRef = setInterval(()=>{
      if(state.paused) return;
      state.seconds++;
      const m = String(Math.floor(state.seconds/60)).padStart(2,'0');
      const s = String(state.seconds%60).padStart(2,'0');
      document.getElementById('timer').textContent = `${m}:${s}`;
    },1000);
  function updateHUD(){
    const m = String(Math.floor(state.seconds/60)).padStart(2,'0');
    const s = String(state.seconds%60).padStart(2,'0');
    document.getElementById('timer').textContent = `${m}:${s}`;
    document.getElementById('lives').textContent = state.lives;
    document.getElementById('nextWord').textContent = sentence[state.eaten] || '¬°Completada!';
  }

  function activatePanel(panel){
    document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
    document.getElementById(`panel-${panel}`).classList.add('active');
    document.querySelectorAll('.gameBtn').forEach(b=>b.classList.remove('active'));
    document.querySelector(`.gameBtn[data-panel="${panel}"]`).classList.add('active');
  function setFeedback(msg, type=''){
    const fb = document.getElementById('feedback');
    fb.textContent = msg;
    fb.className = `feedback ${type}`.trim();
  }

  // Quiz app
  function renderQuiz(){
    const q = quizData[state.quizIndex];
    state.quizAnswered = false;
    document.getElementById('quizQuestion').textContent = `Q${state.quizIndex+1}/3 ‚Äî ${q.q}`;
    document.getElementById('quizAnswers').innerHTML = q.options.map((opt,i)=>`<button data-i="${i}">${opt}</button>`).join('');
    document.getElementById('quizFeedback').textContent = '';
    document.getElementById('quizFeedback').className = 'feedback';
    document.getElementById('quizNext').disabled = true;

    document.querySelectorAll('#quizAnswers button').forEach(btn=>{
      btn.addEventListener('click',()=>answerQuiz(Number(btn.dataset.i)));
    });
  }
  function renderBoard(){
    const board = document.getElementById('board');
    board.innerHTML = '';

  function answerQuiz(choice){
    if(state.quizAnswered) return;
    state.quizAnswered = true;
    const q = quizData[state.quizIndex];
    const fb = document.getElementById('quizFeedback');

    document.querySelectorAll('#quizAnswers button').forEach((btn,i)=>{
      btn.disabled = true;
      if(i === q.correct) btn.classList.add('correct');
      if(i === choice && choice !== q.correct) btn.classList.add('wrong');
    });

    if(choice === q.correct){
      state.quizCorrect++;
      addScore(10,'Quiz');
      fb.textContent = '‚úÖ Correct! +10';
      fb.className = 'feedback ok';
    } else {
      fb.textContent = `‚ùå Wrong. Correct: ${q.options[q.correct]}`;
      fb.className = 'feedback bad';
    }
    for(let y=0;y<size;y++){
      for(let x=0;x<size;x++){
        const cell = document.createElement('div');
        cell.className = 'cell';

    document.getElementById('quizNext').disabled = false;
  }
        const word = state.words.find(w=>!w.eaten && w.x===x && w.y===y);
        if(word){
          cell.classList.add('word');
          cell.textContent = word.word;
        }

  function nextQuiz(){
    if(state.quizIndex < quizData.length - 1){
      state.quizIndex++;
      renderQuiz();
      return;
    }
        if(state.ghost.x===x && state.ghost.y===y){
          cell.classList.add('ghost');
          cell.textContent = '';
        }

    const passed = state.quizCorrect >= 2;
    const fb = document.getElementById('quizFeedback');
    if(passed){
      addStar('Quiz');
      addScore(20,'Quiz');
      fb.textContent = `üèÜ Quiz cleared (${state.quizCorrect}/3). Star earned.`;
      fb.className = 'feedback ok';
    } else {
      fb.textContent = `‚ö†Ô∏è Quiz result ${state.quizCorrect}/3. Need 2/3 for a star.`;
      fb.className = 'feedback bad';
        if(state.pac.x===x && state.pac.y===y){
          cell.classList.add('pac');
          cell.textContent = '';
          const rot = {right:'0deg',down:'90deg',left:'180deg',up:'270deg'}[state.pac.dir] || '0deg';
          cell.style.setProperty('--r', rot);
        }

        board.appendChild(cell);
      }
    }
    document.getElementById('quizNext').disabled = true;
  }

  function restartQuiz(){
    state.quizIndex = 0;
    state.quizCorrect = 0;
    renderQuiz();
  }
  function move(dir){
    if(!state.running) return;
    const vectors = {up:[0,-1],down:[0,1],left:[-1,0],right:[1,0]};
    const d = vectors[dir];
    if(!d) return;

  // Matching pairs app
  function setupPairs(){
    const deck = [];
    pairBase.forEach((pair,idx)=>{
      const [a,b] = pair.split('|');
      deck.push({id:`${idx}a`,pair:idx,text:a,open:false,matched:false});
      deck.push({id:`${idx}b`,pair:idx,text:b,open:false,matched:false});
    });
    state.pairsDeck = deck.sort(()=>Math.random()-0.5);
    state.pairsOpen = [];
    document.getElementById('pairsFeedback').textContent = '';
    drawPairs();
  }
    state.pac.dir = dir;
    state.pac.x = Math.max(0, Math.min(size-1, state.pac.x + d[0]));
    state.pac.y = Math.max(0, Math.min(size-1, state.pac.y + d[1]));

  function drawPairs(){
    const board = document.getElementById('pairsBoard');
    board.innerHTML = state.pairsDeck.map((card,i)=>`<button class="pairCard ${card.open?'open':''} ${card.matched?'matched':''}" data-i="${i}">${(card.open||card.matched)?card.text:'?'}</button>`).join('');
    board.querySelectorAll('button').forEach(btn=>btn.addEventListener('click',()=>flipPair(Number(btn.dataset.i))));
    checkWordEat();
    checkCollision();
    renderBoard();
  }

  function flipPair(i){
    const c = state.pairsDeck[i];
    if(!c || c.open || c.matched || state.pairsOpen.length===2) return;

    c.open = true;
    state.pairsOpen.push(c);
    drawPairs();

    if(state.pairsOpen.length===2){
      const [a,b] = state.pairsOpen;
      if(a.pair===b.pair){
        a.matched = true;
        b.matched = true;
        state.pairsOpen = [];
        addScore(12,'Pairs');
        document.getElementById('pairsFeedback').textContent = '‚úÖ Match! +12';
        document.getElementById('pairsFeedback').className = 'feedback ok';
        if(state.pairsDeck.every(x=>x.matched)){
          addStar('Pairs');
          document.getElementById('pairsFeedback').textContent = 'üèÜ All pairs found. Star earned.';
        }
      } else {
        document.getElementById('pairsFeedback').textContent = '‚ùå Not a pair.';
        document.getElementById('pairsFeedback').className = 'feedback bad';
        setTimeout(()=>{
          a.open = false;
          b.open = false;
          state.pairsOpen = [];
          drawPairs();
        },600);
  function checkWordEat(){
    const item = state.words.find(w=>!w.eaten && w.x===state.pac.x && w.y===state.pac.y);
    if(!item) return;

    const expected = sentence[state.eaten];
    if(item.word === expected){
      item.eaten = true;
      state.eaten++;
      drawOrder();
      updateHUD();
      setFeedback(`‚úÖ Correcto: ${item.word}`, 'ok');

      if(state.eaten === sentence.length){
        state.running = false;
        clearInterval(state.timerRef);
        clearInterval(state.ghostRef);
        setFeedback('üèÜ ¬°Excelente! Ordenaste toda la frase.', 'ok');
      }
    } else {
      state.lives--;
      updateHUD();
      setFeedback(`‚ùå Orden incorrecto. Deb√≠as comer: ${expected}`, 'bad');
      if(state.lives <= 0){
        state.running = false;
        clearInterval(state.timerRef);
        clearInterval(state.ghostRef);
        setFeedback('üíÄ Sin vidas. Reinicia para intentarlo otra vez.', 'bad');
      }
    }
  }

  // Wheel app
  function spinWheel(){
    const task = wheelTasks[Math.floor(Math.random()*wheelTasks.length)];
    document.getElementById('wheelResult').textContent = task;
    document.getElementById('wheelFeedback').textContent = '‚úÖ Challenge generated. +5 points';
    document.getElementById('wheelFeedback').className = 'feedback ok';
    addScore(5,'Wheel');
  }

  // Anagram app
  function renderAnagram(){
    const item = anagrams[state.anagramIndex];
    document.getElementById('anagramWord').textContent = item.scrambled;
    document.getElementById('anagramInput').value = '';
    document.getElementById('anagramFeedback').textContent = '';
    document.getElementById('anagramFeedback').className = 'feedback';
  function moveGhost(){
    const dx = state.pac.x - state.ghost.x;
    const dy = state.pac.y - state.ghost.y;
    if(Math.abs(dx) >= Math.abs(dy) && dx !== 0) state.ghost.x += Math.sign(dx);
    else if(dy !== 0) state.ghost.y += Math.sign(dy);
  }

  function checkAnagram(){
    const item = anagrams[state.anagramIndex];
    const input = document.getElementById('anagramInput').value.trim().toUpperCase();
    const fb = document.getElementById('anagramFeedback');

    if(!input){
      fb.textContent = 'Type an answer first.';
      fb.className = 'feedback bad';
      return;
    }

    if(input === item.answer){
      fb.textContent = '‚úÖ Correct anagram! +10';
      fb.className = 'feedback ok';
      addScore(10,'Anagram');
      if(item.answer === 'CHATBOT') addStar('Anagram');
    } else {
      fb.textContent = `‚ùå Not correct. Try again.`;
      fb.className = 'feedback bad';
  function checkCollision(){
    if(state.running && state.pac.x === state.ghost.x && state.pac.y === state.ghost.y){
      state.running = false;
      clearInterval(state.timerRef);
      clearInterval(state.ghostRef);
      setFeedback('üëæ El monstruo te atrap√≥. Pulsa Reiniciar.', 'bad');
    }
  }

  function nextAnagram(){
    state.anagramIndex = (state.anagramIndex + 1) % anagrams.length;
    renderAnagram();
  }
  document.getElementById('openGameBtn').addEventListener('click', () => {
    updateAssignInfo();
    setScreen('gameScreen');
    setupGame();
  });

  function resetAll(){
    localStorage.removeItem('pitGamesV4');
    state.score = 0;
    state.stars = 0;
    state.best = '-';
    state.quizIndex = 0;
    state.quizCorrect = 0;
    state.anagramIndex = 0;
    hud();
    restartQuiz();
    setupPairs();
    renderAnagram();
    document.getElementById('wheelResult').textContent = 'Press SPIN to get a challenge.';
    document.getElementById('wheelFeedback').textContent = '';
    tip('Reset complete. Choose an app and play.');
  }
  document.getElementById('restartBtn').addEventListener('click', setupGame);
  document.getElementById('backBtn').addEventListener('click', () => {
    state.running = false;
    clearInterval(state.timerRef);
    clearInterval(state.ghostRef);
    setScreen('menuScreen');
  });

  // events
  document.querySelectorAll('.gameBtn').forEach(btn=>{
    btn.addEventListener('click',()=>{
      activatePanel(btn.dataset.panel);
      tip(`Now using ${btn.textContent.split('\n')[0].trim()}.`);
    });
  document.querySelectorAll('[data-dir]').forEach(btn => {
    btn.addEventListener('click', () => move(btn.dataset.dir));
  });

  document.getElementById('quizNext').addEventListener('click', nextQuiz);
  document.getElementById('quizRestart').addEventListener('click', restartQuiz);
  document.getElementById('pairsRestart').addEventListener('click', setupPairs);
  document.getElementById('wheelSpin').addEventListener('click', spinWheel);
  document.getElementById('anagramCheck').addEventListener('click', checkAnagram);
  document.getElementById('anagramNext').addEventListener('click', nextAnagram);
  document.getElementById('pauseBtn').addEventListener('click', ()=>{ state.paused = !state.paused; tip(state.paused ? 'Timer paused.' : 'Timer resumed.'); });
  document.getElementById('resetBtn').addEventListener('click', resetAll);

  // init
  hud();
  restartQuiz();
  setupPairs();
  renderAnagram();
  startTimer();
  window.addEventListener('keydown', (e) => {
    const map = {ArrowUp:'up',ArrowDown:'down',ArrowLeft:'left',ArrowRight:'right'};
    if(map[e.key]){ e.preventDefault(); move(map[e.key]); }
  });
</script>

</body>
</html>
