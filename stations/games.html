<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Word Invaders ‚Äî Build the Sentence</title>
  <style>
    :root{
      --bg:#050816;
      --panel:rgba(255,255,255,.06);
      --line:rgba(255,255,255,.14);
      --ink:#eaf0ff;
      --muted:#a8b4d8;
      --ok:#2ee59d;
      --bad:#ff5470;
      --warn:#ffd166;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:radial-gradient(900px 520px at 20% -10%, rgba(123,92,255,.35), transparent 60%),
                 radial-gradient(900px 520px at 90% 10%, rgba(46,229,157,.18), transparent 65%),
                 var(--bg);
      color:var(--ink);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:14px;
    }
    .wrap{
      width:min(1100px,100%);
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:12px;
    }
    @media(max-width:980px){.wrap{grid-template-columns:1fr}}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow:0 18px 50px rgba(0,0,0,.45);
      overflow:hidden;
    }
    .top{
      padding:12px 14px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      background:rgba(0,0,0,.18);
      border-bottom:1px solid var(--line);
    }
    h1{margin:0;font-size:16px;letter-spacing:.3px}
    .sub{margin:4px 0 0;color:var(--muted);font-size:12px;line-height:1.3}
    .pills{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .pill{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:999px;
      padding:7px 10px;
      font-weight:900;
      font-size:12px;
      color:var(--ink);
      white-space:nowrap;
      user-select:none;
    }
    .pill b{color:var(--warn)}
    canvas{display:block;width:100%;height:auto;background:#020413}
    .side{padding:12px 14px}
    .box{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      margin-bottom:10px;
    }
    .box h2{
      margin:0 0 8px;
      font-size:12px;
      letter-spacing:.45px;
      text-transform:uppercase;
      color:var(--muted);
    }
    .slots{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      min-height:44px;
    }
    .slot{
      min-width:44px;
      padding:10px 12px;
      border-radius:12px;
      border:1px dashed rgba(255,255,255,.22);
      background:rgba(0,0,0,.18);
      font-weight:1000;
      text-align:center;
      color:rgba(255,255,255,.7);
    }
    .slot.filled{
      border-style:solid;
      border-color:rgba(46,229,157,.55);
      background:rgba(46,229,157,.12);
      color:var(--ink);
    }
    .fb{
      min-height:22px;
      font-weight:900;
      color:var(--muted);
      line-height:1.25;
      font-size:12px;
    }
    .fb.ok{color:var(--ok)}
    .fb.bad{color:var(--bad)}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .btn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.08);
      color:var(--ink);
      padding:10px 12px;
      border-radius:14px;
      font-weight:1000;
      cursor:pointer;
      user-select:none;
    }
    .btn.primary{background:rgba(123,92,255,.25);border-color:rgba(123,92,255,.55)}
    .hint{
      margin:8px 0 0;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }
    .kbd{
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
      border:1px solid var(--line);
      background:rgba(255,255,255,.08);
      padding:2px 6px;
      border-radius:8px;
      font-weight:900;
      color:var(--ink);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <div>
          <h1>Word Invaders ‚Äî Build the Sentence</h1>
          <div class="sub">
            Instrucciones: mueve con <span class="kbd">‚Üê ‚Üí</span> o <span class="kbd">A D</span>. Dispara con <span class="kbd">Espacio</span>.
            No hay pistas de qu√© palabra es correcta.
          </div>
        </div>
        <div class="pills">
          <div class="pill">‚ù§Ô∏è Lives: <b id="lives">3</b></div>
          <div class="pill">‚ùå Strikes: <b id="strikes">0</b></div>
          <div class="pill">üî• Streak: <b id="streak">0</b></div>
          <div class="pill">‚≠ê Score: <b id="score">0</b></div>
        </div>
      </div>
      <canvas id="cv" width="900" height="560"></canvas>
    </div>

    <div class="card side">
      <div class="box">
        <h2>Progreso</h2>
        <div class="slots" id="slots"></div>
        <div class="fb" id="fb">Pulsa ‚ÄúStart‚Äù para comenzar.</div>
      </div>

      <div class="box">
        <h2>Controles</h2>
        <div class="row">
          <button class="btn primary" id="startBtn">Start</button>
          <button class="btn" id="nextBtn">Next sentence</button>
          <button class="btn" id="restartBtn">Restart</button>
          <button class="btn" onclick="location.href='games.html'">Back</button>
        </div>
        <p class="hint">
          Ajuste clave: este juego mantiene <b>pocas palabras</b> en pantalla (6‚Äì10).<br>
          El alumno debe disparar por comprensi√≥n (sin resaltar la palabra correcta).
        </p>
      </div>
    </div>
  </div>

<script>
(() => {
  // ========= EDIT BANK HERE =========
  const SENTENCES = [
    "I always do my homework at night.",
    "She doesn‚Äôt like coffee.",
    "Do they play football on Fridays?",
    "We don‚Äôt watch TV in the morning.",
    "I will call you tonight.",
    "They are going to visit Madrid tomorrow.",
    "If it rains, we will stay at home.",
    "If you study, you will pass the test."
  ];

  // ========= CONFIG =========
  const MAX_WORDS_ON_SCREEN = 8;       // << FEWER WORDS
  const FALL_SPEED_MIN = 0.35;
  const FALL_SPEED_MAX = 0.65;
  const SPAWN_MS = 900;
  const SHOT_SPEED = 8;

  const cv = document.getElementById("cv");
  const ctx = cv.getContext("2d");

  const UI = {
    lives: document.getElementById("lives"),
    strikes: document.getElementById("strikes"),
    streak: document.getElementById("streak"),
    score: document.getElementById("score"),
    slots: document.getElementById("slots"),
    fb: document.getElementById("fb"),
    startBtn: document.getElementById("startBtn"),
    nextBtn: document.getElementById("nextBtn"),
    restartBtn: document.getElementById("restartBtn"),
  };

  const W = cv.width, H = cv.height;

  const state = {
    running:false,
    sentence:"",
    tokens:[],
    expected:0,
    lives:3,
    strikes:0,
    streak:0,
    score:0,
    lastSpawn:0,
    words:[], // {text,x,y,vy,isCorrect,idx,w,h}
    shots:[], // {x,y}
    ship:{x:W/2, w:64, h:22, speed:6},
    keys:{},
    lastT:0
  };

  function padSlots(){
    UI.slots.innerHTML = "";
    state.tokens.forEach((_,i)=>{
      const d = document.createElement("div");
      d.className = "slot" + (i < state.expected ? " filled" : "");
      d.textContent = (i < state.expected) ? "‚úì" : "_";
      UI.slots.appendChild(d);
    });
  }

  function setFB(msg, cls=""){
    UI.fb.className = "fb" + (cls ? ` ${cls}` : "");
    UI.fb.textContent = msg;
  }

  function updateHUD(){
    UI.lives.textContent = state.lives;
    UI.strikes.textContent = state.strikes;
    UI.streak.textContent = state.streak;
    UI.score.textContent = state.score;
    padSlots();
  }

  function pickSentence(){
    state.sentence = SENTENCES[Math.floor(Math.random()*SENTENCES.length)];
    state.tokens = state.sentence.trim().split(/\s+/);
    state.expected = 0;
    state.words = [];
    state.shots = [];
    state.lastSpawn = 0;
    updateHUD();
    setFB("Juego iniciado. Construye la frase disparando palabras.", "");
  }

  function resetAll(){
    state.running = false;
    state.lives = 3;
    state.strikes = 0;
    state.streak = 0;
    state.score = 0;
    pickSentence();
  }

  function spawnWord(){
    if (state.words.length >= MAX_WORDS_ON_SCREEN) return;

    // create pool: correct tokens + distractors
    const distractPool = new Set();
    SENTENCES.forEach(s=>{
      if (s === state.sentence) return;
      s.trim().split(/\s+/).forEach(w=>distractPool.add(w));
    });
    const distract = [...distractPool];

    // 60% chance to spawn a correct remaining token (random among remaining)
    let isCorrect = Math.random() < 0.60 && state.expected < state.tokens.length;
    let text, idx;

    if (isCorrect) {
      // spawn one of the remaining correct tokens (NOT necessarily the next one)
      const remaining = [];
      for (let i=state.expected; i<state.tokens.length; i++) remaining.push(i);
      idx = remaining[Math.floor(Math.random()*remaining.length)];
      text = state.tokens[idx];
    } else {
      text = distract.length ? distract[Math.floor(Math.random()*distract.length)] : "the";
      idx = -1;
    }

    const x = 40 + Math.random()*(W-80);
    const y = -30;
    const vy = FALL_SPEED_MIN + Math.random()*(FALL_SPEED_MAX-FALL_SPEED_MIN);

    state.words.push({
      text, x, y, vy, isCorrect: idx>=0, idx,
      w: 0, h: 0
    });
  }

  function drawShip(){
    const x = state.ship.x;
    const y = H - 50;
    // body
    ctx.fillStyle = "rgba(255,255,255,.9)";
    ctx.fillRect(x - state.ship.w/2, y, state.ship.w, state.ship.h);
    // cannon
    ctx.fillStyle = "rgba(123,92,255,.9)";
    ctx.fillRect(x - 7, y - 16, 14, 16);
    ctx.fillStyle = "rgba(0,0,0,.35)";
    ctx.fillRect(x - state.ship.w/2, y + state.ship.h - 4, state.ship.w, 4);
  }

  function measureWord(word, fontSize){
    ctx.font = `1000 ${fontSize}px system-ui, -apple-system, Segoe UI, Roboto, Arial`;
    const w = ctx.measureText(word).width;
    return {w, h: fontSize + 10};
  }

  function drawWord(w){
    // BIG font
    let fontSize = 22;
    let m = measureWord(w.text, fontSize);
    while (m.w > 200 && fontSize > 14){
      fontSize -= 1;
      m = measureWord(w.text, fontSize);
    }
    w.w = m.w + 24;
    w.h = m.h;

    const x = w.x - w.w/2;
    const y = w.y - w.h/2;

    ctx.fillStyle = "rgba(255,255,255,.10)";
    ctx.strokeStyle = "rgba(255,255,255,.20)";
    ctx.lineWidth = 1.2;
    roundRect(x, y, w.w, w.h, 14);
    ctx.fill();
    ctx.stroke();

    ctx.fillStyle = "rgba(255,255,255,.95)";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.font = `1000 ${fontSize}px system-ui, -apple-system, Segoe UI, Roboto, Arial`;
    ctx.fillText(w.text, w.x, w.y + 1);
  }

  function roundRect(x,y,w,h,r){
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r);
    ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r);
    ctx.arcTo(x,y,x+w,y,r);
    ctx.closePath();
  }

  function shoot(){
    if (!state.running) return;
    state.shots.push({x: state.ship.x, y: H - 70});
  }

  function handleHit(word){
    // Only correct if it matches the NEXT required token (idx === expected)
    const expectedText = state.tokens[state.expected];
    const ok = word.isCorrect && word.idx === state.expected && word.text === expectedText;

    if (ok){
      state.expected++;
      state.score += 10;
      state.streak++;
      setFB("‚úÖ Correct!", "ok");

      if (state.expected >= state.tokens.length){
        state.running = false;
        state.score += 30;
        setFB("üèÜ Sentence completed! Press Next sentence.", "ok");
      }
    } else {
      state.strikes++;
      state.streak = 0;
      state.lives--;
      setFB("‚ùå Wrong word.", "bad");
      if (state.lives <= 0){
        state.running = false;
        setFB("üíÄ Game Over. Press Restart.", "bad");
      }
    }
    updateHUD();
  }

  function update(dt, t){
    // movement
    if (state.keys["ArrowLeft"] || state.keys["a"]) state.ship.x -= state.ship.speed;
    if (state.keys["ArrowRight"] || state.keys["d"]) state.ship.x += state.ship.speed;
    state.ship.x = Math.max(40, Math.min(W-40, state.ship.x));

    // spawn
    if (state.running && t - state.lastSpawn > SPAWN_MS){
      state.lastSpawn = t;
      spawnWord();
    }

    // words fall
    for (const w of state.words) w.y += w.vy * dt;

    // shots
    for (const s of state.shots) s.y -= SHOT_SPEED * dt;

    // collisions
    for (let si=state.shots.length-1; si>=0; si--){
      const s = state.shots[si];
      for (let wi=state.words.length-1; wi>=0; wi--){
        const w = state.words[wi];
        if (!w.w) continue;
        const left = w.x - w.w/2, right = w.x + w.w/2;
        const top = w.y - w.h/2, bottom = w.y + w.h/2;

        if (s.x >= left && s.x <= right && s.y >= top && s.y <= bottom){
          // remove both
          state.shots.splice(si,1);
          state.words.splice(wi,1);
          handleHit(w);
          break;
        }
      }
    }

    // cleanup
    state.shots = state.shots.filter(s => s.y > -20);
    // words that reach bottom => remove (no penalty)
    state.words = state.words.filter(w => w.y < H + 80);
  }

  function render(){
    ctx.clearRect(0,0,W,H);

    // stars
    ctx.fillStyle = "rgba(255,255,255,.03)";
    for (let i=0;i<120;i++){
      const x = (i*73)%W;
      const y = (i*151)%H;
      ctx.fillRect(x,y,2,2);
    }

    // shots
    ctx.fillStyle = "rgba(255,209,102,.95)";
    for (const s of state.shots){
      ctx.beginPath();
      ctx.arc(s.x, s.y, 5, 0, Math.PI*2);
      ctx.fill();
    }

    // words
    for (const w of state.words) drawWord(w);

    // ship
    drawShip();

    // floor
    ctx.strokeStyle = "rgba(255,255,255,.10)";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(0, H-26);
    ctx.lineTo(W, H-26);
    ctx.stroke();
  }

  function loop(t){
    const dt = Math.min(2.2, (t - state.lastT)/16.67);
    state.lastT = t;

    if (state.running) update(dt, t);
    render();
    requestAnimationFrame(loop);
  }

  // controls
  window.addEventListener("keydown", (e)=>{
    const k = e.key;
    if (k === " ") { e.preventDefault(); shoot(); return; }
    state.keys[k] = true;
    state.keys[k.toLowerCase()] = true;
  }, {passive:false});

  window.addEventListener("keyup", (e)=>{
    const k = e.key;
    state.keys[k] = false;
    state.keys[k.toLowerCase()] = false;
  });

  // buttons
  UI.startBtn.addEventListener("click", ()=>{
    if (!state.sentence) pickSentence();
    state.running = true;
    setFB("Go!", "ok");
  });
  UI.nextBtn.addEventListener("click", ()=>{
    pickSentence();
    state.running = true;
  });
  UI.restartBtn.addEventListener("click", ()=>{
    resetAll();
    state.running = true;
  });

  // init
  pickSentence();
  updateHUD();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
