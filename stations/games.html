!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vocabulary Station</title>

<style>

/* DARK METAL GRAY BACKGROUND + WHITE TEXT */
body {
    background: linear-gradient(135deg, #2b2b2b, #1f1f1f, #2a2a2a);
    color: white;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
}

/* UNIVERSAL ACTIVITY COLORS */
.ordering-theme { background: #00B0FF20; border-left: 6px solid #00B0FF; }
.matching-theme { background: #AB47BC20; border-left: 6px solid #AB47BC; }
.trivia-theme { background: #4CAF5020; border-left: 6px solid #4CAF50; }
.fill-theme { background: #EF535020; border-left: 6px solid #EF5350; }
.builder-theme { background: #FDD83520; border-left: 6px solid #FDD835; }
.listen-theme { background: #FFA72620; border-left: 6px solid #FFA726; }
.read-theme { background: #5C6BC020; border-left: 6px solid #5C6BC0; }
.speak-theme { background: #26C6DA20; border-left: 6px solid #26C6DA; }

/* FIXED BOTTOM BAR ‚Äî PURPLE */
.fixed-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #6A1B9A;
    padding: 12px;
    display: flex;
    justify-content: center;
    gap: 20px;
    z-index: 9999;
    border-top: 2px solid #4A0072;
    backdrop-filter: blur(6px);
}

/* YELLOW BUTTONS */
.bar-btn {
    background: #FFEB3B;
    color: #1A1A1A;
    padding: 10px 20px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    font-size: 16px;
}
.bar-btn:hover { background: #FBC02D; color: black; }

/* GENERAL LAYOUT */
.screen {
    display: none;
    padding: 30px;
    margin-bottom: 100px;
    border-radius: 12px;
}
#main {
    padding: 30px;
    margin-bottom: 100px;
}
button {
    padding: 12px 20px;
    margin: 10px;
    border-radius: 10px;
    border: none;
    background: #4FC3F7;
    cursor: pointer;
    font-size: 18px;
    color: black;
}
button:hover { background: #0288D1; color: white; }

/* ========================= */
/* UNIVERSAL HUD CSS */
/* ========================= */

#progress-container {
    width: 100%;
    height: 12px;
    background: #444;
    border-bottom: 2px solid #222;
}
#progress-bar {
    width: 0%;
    height: 100%;
    background: #FFEB3B;
    transition: width 0.4s ease;
}

#hud-row {
    display: flex;
    gap: 10px;
    padding: 10px 20px;
}

#score-box {
    padding: 10px 20px;
    font-size: 20px;
    background: #6A1B9A;
    border-radius: 10px;
}

#timer-box {
    padding: 10px 20px;
    font-size: 20px;
    background: #AB47BC;
    border-radius: 10px;
}

#tip-box {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #333;
    padding: 15px 20px;
    border-radius: 10px;
    border: 2px solid #FFEB3B;
    font-size: 16px;
    max-width: 250px;
    color: white;
    z-index: 9999;
}

</style>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>THE PIT ‚Äì Games Station</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
  <title>Games Station</title>
  <style>
    :root{--bg1:#dbeafe;--bg2:#2563eb;--bg3:#0b1a44;--ink:#0f172a;--panel:#f8fafc;--line:#bfdbfe;--brand:#1d4ed8;--ok:#166534;--bad:#991b1b}
    :root{--bg:#0f172a;--panel:#111827;--card:#1f2937;--line:#374151;--ink:#e5e7eb;--brand:#22d3ee;--ok:#86efac;--bad:#fca5a5}
    *{box-sizing:border-box}
    body{margin:0;font-family:'Orbitron',sans-serif;background:radial-gradient(circle,var(--bg1) 0%,var(--bg2) 56%,var(--bg3) 100%);color:var(--ink)}
    .app{width:min(1120px,95vw);margin:14px auto 92px;background:#fff;border-radius:20px;padding:14px;box-shadow:0 18px 42px rgba(2,6,23,.45)}
    h1{margin:0;text-align:center;color:#1e3a8a;font-size:clamp(20px,4vw,30px)}
    .sub{margin:6px 0 10px;text-align:center;color:var(--brand);font-size:12px}

    body{margin:0;background:radial-gradient(circle at top,#1e3a8a,#0f172a 60%);color:var(--ink);font-family:Arial,sans-serif}
    .app{width:min(1100px,96vw);margin:12px auto 84px;background:rgba(15,23,42,.85);border:1px solid #334155;border-radius:14px;padding:12px}
    h1{margin:0;text-align:center;color:#67e8f9}
    .sub{text-align:center;margin:6px 0 10px;color:#bae6fd;font-size:14px}
    .hud{display:grid;grid-template-columns:repeat(4,minmax(120px,1fr));gap:8px;margin-bottom:10px}
    .box{background:#eff6ff;border:2px solid #93c5fd;border-radius:10px;padding:9px;font-size:12px;font-weight:800;color:#1e3a8a}
    .tip{background:#ecfeff;border:2px solid #67e8f9;border-radius:10px;padding:10px;font-size:12px;color:#0f766e;margin-bottom:10px}

    .gameMenu{display:grid;grid-template-columns:repeat(4,minmax(150px,1fr));gap:8px;margin-bottom:10px}
    .gameBtn{border:2px solid var(--line);background:#fff;color:#1e3a8a;border-radius:10px;padding:10px;font-family:inherit;font-size:11px;font-weight:800;cursor:pointer;text-align:left}
    .gameBtn.active{background:#dbeafe;border-color:#2563eb}

    .panel{display:none;background:var(--panel);border:2px solid #cbd5e1;border-radius:12px;padding:12px}
    .box{background:var(--card);border:1px solid var(--line);border-radius:10px;padding:10px;font-weight:700}
    .tip{background:#082f49;border:1px solid #0e7490;color:#cffafe;border-radius:10px;padding:10px;margin-bottom:10px}
    .menu{display:grid;grid-template-columns:repeat(3,minmax(170px,1fr));gap:8px}
    .gameBtn{background:#0b1222;border:1px solid #475569;color:#e2e8f0;border-radius:10px;padding:10px;text-align:left;cursor:pointer;font-weight:700}
    .gameBtn.active{border-color:var(--brand);background:#0e2235}
    .panel{display:none;background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:12px;margin-top:10px;min-height:220px}
    .panel.active{display:block}
    .panel h2{margin:0 0 8px;color:#1e3a8a;font-size:15px}
    .question{font-size:13px;margin:6px 0 8px}
    .prompt{font-size:18px;font-weight:700;margin-bottom:8px;color:#a5f3fc}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    button{border:0;border-radius:8px;padding:9px 11px;font-weight:700;cursor:pointer}
    .primary{background:#22d3ee;color:#082f49}
    .soft{background:#334155;color:#e2e8f0}
    .answers{display:grid;gap:8px}
    .answers button{border:2px solid var(--line);background:#fff;color:#1e3a8a;border-radius:10px;padding:10px;font-family:inherit;font-size:11px;font-weight:800;text-align:left;cursor:pointer}
    .answers button:disabled{opacity:.85;cursor:not-allowed}
    .answers button.correct{background:#dcfce7;border-color:#22c55e;color:var(--ok)}
    .answers button.wrong{background:#fee2e2;border-color:#ef4444;color:var(--bad)}
    .feedback{min-height:18px;margin-top:8px;font-size:12px;font-weight:800}
    .answers button{text-align:left;background:#1e293b;color:#e2e8f0;border:1px solid #475569}
    .feedback{min-height:18px;margin-top:8px;font-weight:700}
    .ok{color:var(--ok)} .bad{color:var(--bad)}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .btn{border:0;border-radius:10px;padding:9px 12px;font-family:inherit;font-size:11px;font-weight:900;cursor:pointer}
    .primary{background:#2563eb;color:#fff}
    .soft{background:#e2e8f0;color:#0f172a}

    .pairsBoard{display:grid;grid-template-columns:repeat(4,minmax(66px,1fr));gap:8px}
    .pairCard{height:62px;border:2px solid var(--line);background:#dbeafe;border-radius:10px;font-family:inherit;font-size:11px;font-weight:800;color:#1e3a8a;cursor:pointer}
    .pairCard.open,.pairCard.matched{background:#fff}
    .pairCard.matched{border-color:#22c55e;color:#166534}

    .wheelCard{background:#eff6ff;border:2px dashed #93c5fd;border-radius:10px;padding:12px;font-size:12px;font-weight:800;color:#1e3a8a;min-height:54px}

    .anagramWord{font-size:13px;font-weight:900;color:#1e3a8a;margin:6px 0}
    .anagramInput{width:100%;border:2px solid var(--line);border-radius:10px;padding:10px;font-family:inherit;font-size:12px}

    .fixed{position:fixed;left:0;right:0;bottom:0;background:#0f172a;border-top:2px solid #1e293b;padding:8px;display:flex;justify-content:center;gap:8px;flex-wrap:wrap;z-index:20}
    .fixed button{border:0;border-radius:10px;padding:8px 10px;background:#dbeafe;color:#1e3a8a;font-family:inherit;font-size:11px;font-weight:900;cursor:pointer}

    @media (max-width:900px){.gameMenu{grid-template-columns:repeat(2,minmax(140px,1fr))}}
    @media (max-width:680px){
      .app{padding:10px;margin:8px auto 84px}
      .hud{grid-template-columns:repeat(2,minmax(120px,1fr))}
      .box,.tip{font-size:11px}
      .question{font-size:12px}
      .answers button,.gameBtn,.btn,.fixed button{font-size:10px}
      .pairsBoard{grid-template-columns:repeat(4,minmax(56px,1fr));gap:6px}
      .pairCard{height:56px;font-size:10px}
    }
    .board{display:grid;grid-template-columns:repeat(4,minmax(70px,1fr));gap:8px}
    .card{height:56px;background:#1e293b;border:1px solid #475569;color:#e2e8f0}
    .card.matched{background:#14532d;border-color:#22c55e}
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .chip{background:#1e3a8a;border:1px solid #60a5fa;color:#dbeafe;padding:8px 10px;border-radius:999px;cursor:pointer}
    .fixed{position:fixed;left:0;right:0;bottom:0;background:#020617;padding:8px;display:flex;justify-content:center;gap:8px;border-top:1px solid #334155}
    @media(max-width:800px){.menu{grid-template-columns:repeat(2,minmax(140px,1fr))}.hud{grid-template-columns:repeat(2,minmax(120px,1fr))}}
  </style>
</head>

<body>

<!-- ========================= -->
<!-- UNIVERSAL HUD BLOCK -->
<!-- ========================= -->

<div id="progress-container">
    <div id="progress-bar"></div>
</div>

<div id="hud-row">
    <div id="score-box">Score: <span id="score">0</span></div>
    <div id="timer-box">Time: <span id="timer">00:00</span></div>
</div>

<div id="tip-box">
    <strong>Tip:</strong> <span id="tip-text">Choose an activity to begin!</span>
</div>

<!-- ========================= -->
<!-- END HUD BLOCK -->
<!-- ========================= -->

<!-- FIXED BOTTOM BAR -->
<div class="fixed-bar">
    <button class="bar-btn" onclick="goBack()">Back</button>
    <button class="bar-btn" onclick="location.href='../index.html'">Main Menu</button>
    <button class="bar-btn" onclick="alert('Paused')">Pause</button>
</div>

<!-- MAIN MENU -->
<div id="main">
    <h1>Vocabulary Station</h1>
    <button onclick="openScreen('matching')">Matching</button>
    <button onclick="openScreen('ordering')">Ordering</button>
    <button onclick="openScreen('fill')">Fill in the Blanks</button>
</div>

<!-- MATCHING -->
<div id="matching" class="screen matching-theme">
    <h2>Matching Activity</h2>
    <p>Match the words with their definitions.</p>
</div>

<!-- ORDERING -->
<div id="ordering" class="screen ordering-theme">
    <h2>Ordering Activity</h2>
    <p>Put the words in the correct order.</p>
</div>

<!-- FILL IN THE BLANKS -->
<div id="fill" class="screen fill-theme">
    <h2>Fill in the Blanks</h2>
    <p>Complete the sentences with the correct words.</p>
</div>
  <main class="app">
    <h1>GAMES STATION</h1>
    <p class="sub">Visible working apps: Quiz ‚Ä¢ Matching Pairs ‚Ä¢ Spin Wheel ‚Ä¢ Anagram</p>
    <h1>üéÆ Games Station</h1>
    <p class="sub">Snakes & Ladders ‚Ä¢ Match Up ‚Ä¢ Comecocos ‚Ä¢ Space Invaders ‚Ä¢ Unjumble ‚Ä¢ Fishing Bowl ‚Ä¢ Basketball ‚Ä¢ Speed Race ‚Ä¢ Guacamole</p>

    <section class="hud">
      <div class="box">SCORE: <span id="score">0</span></div>
      <div class="box">STARS: <span id="stars">0</span></div>
      <div class="box">TIME: <span id="timer">00:00</span></div>
      <div class="box">BEST APP: <span id="best">-</span></div>
    </section>

    <div class="tip"><strong>Tip:</strong> <span id="tip">Open any app and play. Each app gives points and stars.</span></div>

    <section class="gameMenu" id="gameMenu">
      <button class="gameBtn active" data-panel="quiz">üìù Quiz App<br><small>3-question skill check</small></button>
      <button class="gameBtn" data-panel="pairs">üÉè Matching Pairs App<br><small>memory + vocabulary</small></button>
      <button class="gameBtn" data-panel="wheel">üéØ Spin Wheel App<br><small>random speaking/writing tasks</small></button>
      <button class="gameBtn" data-panel="anagram">üî§ Anagram App<br><small>unscramble words</small></button>
    </section>

    <section id="panel-quiz" class="panel active">
      <h2>Quiz App</h2>
      <p id="quizQuestion" class="question"></p>
      <div id="quizAnswers" class="answers"></div>
      <div id="quizFeedback" class="feedback"></div>
      <div class="row">
        <button class="btn primary" id="quizNext" disabled>Next Question</button>
        <button class="btn soft" id="quizRestart">Restart Quiz</button>
      </div>
    </section>

    <section id="panel-pairs" class="panel">
      <h2>Matching Pairs App</h2>
      <div id="pairsBoard" class="pairsBoard"></div>
      <div id="pairsFeedback" class="feedback"></div>
      <div class="row">
        <button class="btn soft" id="pairsRestart">Restart Pairs</button>
      </div>
      <div class="box">Score: <span id="score">0</span></div>
      <div class="box">Stars: <span id="stars">0</span></div>
      <div class="box">Time: <span id="timer">00:00</span></div>
      <div class="box">Best Game: <span id="best">-</span></div>
    </section>

    <section id="panel-wheel" class="panel">
      <h2>Spin Wheel App</h2>
      <div id="wheelResult" class="wheelCard">Press SPIN to get a challenge.</div>
      <div id="wheelFeedback" class="feedback"></div>
      <div class="row">
        <button class="btn primary" id="wheelSpin">SPIN</button>
      </div>
    </section>
    <div class="tip"><strong>Class goal:</strong> practice Unit 1‚Äì8 vocabulary and grammar from the class summaries while students play.</div>

    <section id="panel-anagram" class="panel">
      <h2>Anagram App</h2>
      <p class="question">Unscramble this word:</p>
      <div id="anagramWord" class="anagramWord">-</div>
      <input id="anagramInput" class="anagramInput" placeholder="Type your answer" />
      <div id="anagramFeedback" class="feedback"></div>
      <div class="row">
        <button class="btn primary" id="anagramCheck">Check</button>
        <button class="btn soft" id="anagramNext">Next Anagram</button>
      </div>
    </section>
    <section class="menu" id="menu"></section>
    <section id="panel" class="panel active"></section>
  </main>

  <div class="fixed">
    <button onclick="location.href='../index.html'">Main Menu</button>
    <button id="pauseBtn">Pause/Resume Timer</button>
    <button id="resetBtn">Reset Score</button>
    <button class="soft" onclick="location.href='../index.html'">Main Menu</button>
    <button class="soft" id="pauseBtn">Pause/Resume</button>
    <button class="soft" id="resetBtn">Reset</button>
  </div>

<script>

/* SCREEN NAVIGATION */
function openScreen(id) {
    document.querySelectorAll('.screen, #main').forEach(s => s.style.display = 'none');
    document.getElementById(id).style.display = 'block';

    setTip("Complete the activity to earn points!");
    startTimer();
    setProgress(20);
const state={score:0,stars:0,best:'-',seconds:0,paused:false,timerRef:null,active:'snakes'};
const saved=JSON.parse(localStorage.getItem('gamesStationV1')||'{}');
Object.assign(state,{score:saved.score||0,stars:saved.stars||0,best:saved.best||'-'});


const score=document.getElementById('score');
const stars=document.getElementById('stars');
const timer=document.getElementById('timer');
const best=document.getElementById('best');
const menu=document.getElementById('menu');
const panel=document.getElementById('panel');
const pauseBtn=document.getElementById('pauseBtn');
const resetBtn=document.getElementById('resetBtn');

const UNIT_SUMMARY=[
  {
    unit:1,
    grammar:'Past simple + there was/were',
    vocabulary:['appear','disappear','container','safe','worried','excited','hide','include','inside','outside','items'],
    sentenceOrder:['There','were','old','containers','inside','the','factory.']
  },
  {
    unit:2,
    grammar:'Past continuous + interrupted actions',
    vocabulary:['bright','huge','strange','materials','artist','designer','illustrator','photographer','brilliant','enormous'],
    sentenceOrder:['While','we','were','waiting,','the','photographer','was','taking','pictures.']
  },
  {
    unit:3,
    grammar:'First conditional',
    vocabulary:['cycling','concert','festival','lake','picnic area','working out','jogging','outdoor gym','fun run'],
    sentenceOrder:['If','we','train','twice','a','week,','we','will','improve','quickly.']
  },
  {
    unit:4,
    grammar:'Going to + will predictions',
    vocabulary:['take part','volunteer','community','prediction','renewable','technology','environmentally friendly'],
    sentenceOrder:['I','am','going','to','volunteer','at','the','community','centre.']
  },
  {
    unit:5,
    grammar:'Comparatives + superlatives + can/could',
    vocabulary:['harder','faster','better','more exciting','most popular','the best','the most difficult'],
    sentenceOrder:['Basketball','is','more','exciting','than','tennis.']
  },
  {
    unit:6,
    grammar:'Present perfect + since/for + ever/never',
    vocabulary:['injury','train','warm up','energy','lifestyle','stretch','muscles','rest'],
    sentenceOrder:['I','have','felt','more','energetic','since','I','started','training.']
  },
  {
    unit:7,
    grammar:'Must/should/have to',
    vocabulary:['respect','rule','responsible','protect','uniform','attendance','behave'],
    sentenceOrder:['Students','must','protect','their','passwords','online.']
  },
  {
    unit:8,
    grammar:'Reflexive + indefinite pronouns',
    vocabulary:['somebody','nobody','everywhere','themselves','everybody','anyone','something','nothing'],
    sentenceOrder:['Everybody','can','help','if','they','believe','in','themselves.']
  }
];

const QUESTION_BANK={
  grammar:[
    {unit:1,q:'Unit 1: Choose the correct sentence.',o:['There was many containers.','There were many containers.','There were much container.'],c:1},
    {unit:2,q:'Unit 2: Complete the interrupted action.',o:['While we waited, it started to rain.','While we wait, it starts rain.','While we are waiting, it started rain.'],c:0},
    {unit:3,q:'Unit 3: First conditional',o:['If we train, we will improve.','If we will train, we improve.','If we trained, we improve.'],c:0},
    {unit:4,q:'Unit 4: Future plan',o:['I going to volunteer.','I am going to volunteer.','I will going volunteer.'],c:1},
    {unit:5,q:'Unit 5: Comparative form',o:['Basketball is exciting than tennis.','Basketball is more exciting than tennis.','Basketball is most exciting than tennis.'],c:1},
    {unit:6,q:'Unit 6: Present perfect',o:['I have trained since January.','I trained since January.','I am training since January.'],c:0},
    {unit:7,q:'Unit 7: Obligation',o:['Students should to protect passwords.','Students must protect passwords.','Students must protects passwords.'],c:1},
    {unit:8,q:'Unit 8: Indefinite pronoun',o:['Everybody can help.','Everybody can helps.','Everybody helping can.'],c:0}
  ],
  vocab:[
    {unit:1,q:'Unit 1 vocabulary: choose a word connected to storage.',o:['container','jogging','renewable'],c:0},
    {unit:2,q:'Unit 2 vocabulary: who takes photos?',o:['designer','photographer','illustrator'],c:1},
    {unit:3,q:'Unit 3 vocabulary: choose an outdoor activity.',o:['fun run','container','uniform'],c:0},
    {unit:4,q:'Unit 4 vocabulary: choose the eco word.',o:['prediction','technology','environmentally friendly'],c:2},
    {unit:5,q:'Unit 5 vocabulary: choose a superlative phrase.',o:['more better','the most difficult','faster than'],c:1},
    {unit:6,q:'Unit 6 vocabulary: choose a healthy habit.',o:['stretch','disappear','concert'],c:0},
    {unit:7,q:'Unit 7 vocabulary: choose school duty.',o:['attendance','picnic area','injury'],c:0},
    {unit:8,q:'Unit 8 vocabulary: pronoun for all people.',o:['everybody','nobody','somebody'],c:0}
  ]
};

const MATCH_PAIRS=UNIT_SUMMARY.flatMap(u=>{
  const picked=u.vocabulary.slice(0,2);
  return [
    {left:`Unit ${u.unit}: ${picked[0]}`,right:u.grammar},
    {left:picked[1]||picked[0],right:`U${u.unit} vocabulary`}
  ];
});

const games={
  snakes:{name:'üêç Snakes & Ladders',render:renderSnakes},
  matchup:{name:'üß© Match Up',render:renderMatch},
  comecocos:{name:'üëª Comecocos',render:renderComecocos},
  invaders:{name:'üöÄ Space Invaders',render:renderInvaders},
  unjumble:{name:'üîÄ Unjumble',render:renderUnjumble},
  fishing:{name:'üé£ Fishing Bowl',render:renderFishing},
  basketball:{name:'üèÄ Basketball',render:renderBasketball},
  speed:{name:'üèÅ Speed Race',render:renderSpeedRace},
  guacamole:{name:'ü•ë Guacamole',render:renderGuacamole}
};

function persist(){localStorage.setItem('gamesStationV1',JSON.stringify({score:state.score,stars:state.stars,best:state.best}));}
function hud(){score.textContent=state.score;stars.textContent=state.stars;best.textContent=state.best;persist();}
function addScore(n,game){state.score+=n;state.best=games[game].name;hud();}
function addStar(game){state.stars++;state.best=games[game].name;hud();}

function startTimer(){if(state.timerRef)return;state.timerRef=setInterval(()=>{if(state.paused)return;state.seconds++;timer.textContent=`${String(Math.floor(state.seconds/60)).padStart(2,'0')}:${String(state.seconds%60).padStart(2,'0')}`;},1000)}

function buildMenu(){
  menu.innerHTML=Object.entries(games).map(([k,v])=>`<button class="gameBtn ${k===state.active?'active':''}" data-k="${k}">${v.name}</button>`).join('');
  document.querySelectorAll('.gameBtn').forEach(b=>b.onclick=()=>{state.active=b.dataset.k;buildMenu();games[state.active].render();});
}

function goBack() {
    document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
    document.getElementById('main').style.display = 'block';

    stopTimer();
    setTip("Choose an activity to begin!");
    setProgress(0);
function renderMCQ(game,prompt,options,correct,onDone){
  panel.className='panel active';
  panel.innerHTML=`<div class="prompt">${prompt}</div><div class="answers">${options.map((o,i)=>`<button data-i="${i}">${o}</button>`).join('')}</div><div id="fb" class="feedback"></div>${onDone?'<div class="row"><button class="primary" id="next">Next</button></div>':''}`;
  panel.querySelectorAll('.answers button').forEach(btn=>btn.onclick=()=>{const ok=Number(btn.dataset.i)===correct;fb.textContent=ok?'‚úÖ Correct! +10':'‚ùå Try again.';fb.className='feedback '+(ok?'ok':'bad');if(ok){addScore(10,game);panel.querySelectorAll('.answers button').forEach(b=>b.disabled=true);if(onDone)document.getElementById('next').onclick=onDone;}});
}

/* ========================= */
/* UNIVERSAL HUD JS */
/* ========================= */

function setProgress(percent) {
    document.getElementById("progress-bar").style.width = percent + "%";
function randomFrom(list){return list[Math.floor(Math.random()*list.length)];}
function shuffle(list){return [...list].sort(()=>Math.random()-0.5);}

function renderSnakes(){
  panel.className='panel active';
  panel.innerHTML=`<div class="prompt">Roll dice and answer Unit Summary grammar questions to climb! You are on square <span id="sq">1</span>.</div><div class="row"><button class="primary" id="roll">Roll Dice</button></div><div id="play"></div>`;
  let square=1;
  roll.onclick=()=>{
    square=Math.min(30,square+(Math.floor(Math.random()*6)+1));
    sq.textContent=square;
    const x=randomFrom(QUESTION_BANK.grammar);
    renderMCQ('snakes',`[U${x.unit}] ${x.q}`,x.o,x.c,()=>{});
    if(square===30)addStar('snakes');
  };
}

let score = 0;
function addScore(points) {
    score += points;
    document.getElementById("score").textContent = score;
function renderMatch(){
  let deck=[];
  MATCH_PAIRS.forEach((p,i)=>deck.push({p:i,t:p.left,o:false,m:false},{p:i,t:p.right,o:false,m:false}));
  deck=shuffle(deck);
  let open=[];
  const draw=()=>{panel.className='panel active';panel.innerHTML=`<div class="prompt">Find all matching pairs.</div><div class="board">${deck.map((c,i)=>`<button class="card ${c.m?'matched':''}" data-i="${i}">${c.o||c.m?c.t:'?'}</button>`).join('')}</div><div id="fb" class="feedback"></div>`;
    panel.querySelectorAll('.card').forEach(btn=>btn.onclick=()=>{const i=Number(btn.dataset.i),c=deck[i];if(c.o||c.m||open.length===2)return;c.o=true;open.push(i);draw();if(open.length===2){const[a,b]=open.map(n=>deck[n]);if(a.p===b.p){a.m=b.m=true;addScore(8,'matchup');if(deck.every(x=>x.m)){fb.textContent='üèÜ Star earned!';fb.className='feedback ok';addStar('matchup');}open=[];}else{setTimeout(()=>{a.o=b.o=false;open=[];draw();},500);}}});};
  draw();
}

let time = 0;
let timerInterval;

function startTimer() {
    stopTimer();
    time = 0;
    timerInterval = setInterval(() => {
        time++;
        let minutes = String(Math.floor(time / 60)).padStart(2, '0');
        let seconds = String(time % 60).padStart(2, '0');
        document.getElementById("timer").textContent = `${minutes}:${seconds}`;
    }, 1000);
function renderComecocos(){
  const x=randomFrom(QUESTION_BANK.vocab);
  renderMCQ('comecocos',`Comecocos [U${x.unit}] Eat the correct unit word!`,x.o,x.c,()=>{});
}
function renderInvaders(){
  const x=randomFrom(QUESTION_BANK.grammar);
  const wrong=x.o.findIndex((opt,n)=>n!==x.c && /\b(was|were|must|have|is|are|am)\b/i.test(opt));
  renderMCQ('invaders',`Space Invaders [U${x.unit}] Shoot the WRONG sentence!`,x.o,wrong>=0?wrong:0,()=>{});
}

function stopTimer() {
    clearInterval(timerInterval);
function renderUnjumble(){
  const unit=randomFrom(UNIT_SUMMARY);
  const target=unit.sentenceOrder;
  let current=shuffle(target);
  const draw=()=>{panel.className='panel active';panel.innerHTML=`<div class="prompt">Tap words in correct order.</div><div class="chips">${current.map((w,i)=>`<button class="chip" data-i="${i}">${w}</button>`).join('')}</div><div>Sentence: <span id="sent"></span></div><div id="fb" class="feedback"></div>`;
    let built=[];panel.querySelectorAll('.chip').forEach(btn=>btn.onclick=()=>{built.push(current[Number(btn.dataset.i)]);btn.disabled=true;sent.textContent=built.join(' ');if(built.length===target.length){const ok=built.join(' ')==target.join(' ');fb.textContent=ok?'‚úÖ Perfect word order! +12':'‚ùå Order is incorrect.';fb.className='feedback '+(ok?'ok':'bad');if(ok){addScore(12,'unjumble');addStar('unjumble');}}});};
  draw();
}

function setTip(text) {
    document.getElementById("tip-text").textContent = text;
function renderFishing(){
  const x=randomFrom(QUESTION_BANK.vocab);
  renderMCQ('fishing',`Fishing Bowl [U${x.unit}] Catch the vocabulary answer.`,x.o,x.c,()=>{});
}
function renderBasketball(){
  const x=randomFrom(QUESTION_BANK.grammar);
  renderMCQ('basketball',`Basketball [U${x.unit}] Score with grammar!`,x.o,x.c,()=>{});
}

  const state = {
    score: 0,
    stars: 0,
    best: '-',
    seconds: 0,
    paused: false,
    timerRef: null,
    quizIndex: 0,
    quizCorrect: 0,
    quizAnswered: false,
    pairsDeck: [],
    pairsOpen: [],
    anagramIndex: 0
function renderSpeedRace(){
  const qs=shuffle([...QUESTION_BANK.grammar,...QUESTION_BANK.vocab]).slice(0,3).map(x=>({q:`[U${x.unit}] ${x.q}`,o:x.o,c:x.c}));
  let i=0,hits=0;
  const next=()=>{if(i>=qs.length){panel.innerHTML+=`<div class="feedback ${hits>=2?'ok':'bad'}">${hits}/3 correct ${hits>=2?'üèÜ Star!':''}</div>`;if(hits>=2){addStar('speed');addScore(20,'speed');}return;}const x=qs[i++];
    panel.className='panel active';
    panel.innerHTML=`<div class="prompt">Speed Round ${i}/3: ${x.q}</div><div class="answers">${x.o.map((o,n)=>`<button data-i="${n}">${o}</button>`).join('')}</div><div id="fb" class="feedback"></div><div class="row"><button class="primary" id="next">Next</button></div>`;
    panel.querySelectorAll('.answers button').forEach(btn=>btn.onclick=()=>{const ok=Number(btn.dataset.i)===x.c;fb.textContent=ok?'‚úÖ Correct!':'‚ùå Wrong';fb.className='feedback '+(ok?'ok':'bad');if(ok)hits++;panel.querySelectorAll('.answers button').forEach(b=>b.disabled=true);});
    next.onclick=next;
    if(i===1)setTimeout(()=>{if(state.active==='speed')next();},30000);
  };
  next();
}

  const saved = JSON.parse(localStorage.getItem('pitGamesV4') || '{}');
  state.score = saved.score || 0;
  state.stars = saved.stars || 0;
  state.best = saved.best || '-';

  const quizData = [
    {q:'Choose the correct sentence.', options:['She go to school.','She goes to school.','She going school.','She gone school.'], correct:1},
    {q:'Past simple of "eat" is...', options:['eat','eaten','ate','eated'], correct:2},
    {q:'Best contrast connector is...', options:['because','although','and','so'], correct:1}
  ];

  const pairBase = ['big|huge','small|tiny','start|begin','quick|fast'];

  const wheelTasks = [
    'Say one sentence in present simple about your daily routine.',
    'Write one sentence using because and one using although.',
    'Ask for directions politely in English.',
    'Give one prediction about tomorrow using will.',
    'Say 3 healthy habits using should.'
  ];

  const anagrams = [
    {scrambled:'LEAPP', answer:'APPLE'},
    {scrambled:'RYECCL', answer:'RECYCLE'},
    {scrambled:'MOREHOKW', answer:'HOMEWORK'},
    {scrambled:'TACOHB', answer:'CHATBOT'}
  ];

  function persist(){
    localStorage.setItem('pitGamesV4', JSON.stringify({score:state.score, stars:state.stars, best:state.best}));
  }

  function hud(){
    document.getElementById('score').textContent = state.score;
    document.getElementById('stars').textContent = state.stars;
    document.getElementById('best').textContent = state.best;
  }

  function tip(text){
    document.getElementById('tip').textContent = text;
  }

  function addScore(points, app){
    state.score += points;
    if(app) state.best = app;
    hud();
    persist();
  }

  function addStar(app){
    state.stars += 1;
    state.best = app;
    hud();
    persist();
  }

  function startTimer(){
    if(state.timerRef) return;
    state.timerRef = setInterval(()=>{
      if(state.paused) return;
      state.seconds++;
      const m = String(Math.floor(state.seconds/60)).padStart(2,'0');
      const s = String(state.seconds%60).padStart(2,'0');
      document.getElementById('timer').textContent = `${m}:${s}`;
    },1000);
  }

  function activatePanel(panel){
    document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
    document.getElementById(`panel-${panel}`).classList.add('active');
    document.querySelectorAll('.gameBtn').forEach(b=>b.classList.remove('active'));
    document.querySelector(`.gameBtn[data-panel="${panel}"]`).classList.add('active');
  }

  // Quiz app
  function renderQuiz(){
    const q = quizData[state.quizIndex];
    state.quizAnswered = false;
    document.getElementById('quizQuestion').textContent = `Q${state.quizIndex+1}/3 ‚Äî ${q.q}`;
    document.getElementById('quizAnswers').innerHTML = q.options.map((opt,i)=>`<button data-i="${i}">${opt}</button>`).join('');
    document.getElementById('quizFeedback').textContent = '';
    document.getElementById('quizFeedback').className = 'feedback';
    document.getElementById('quizNext').disabled = true;

    document.querySelectorAll('#quizAnswers button').forEach(btn=>{
      btn.addEventListener('click',()=>answerQuiz(Number(btn.dataset.i)));
    });
  }

  function answerQuiz(choice){
    if(state.quizAnswered) return;
    state.quizAnswered = true;
    const q = quizData[state.quizIndex];
    const fb = document.getElementById('quizFeedback');

    document.querySelectorAll('#quizAnswers button').forEach((btn,i)=>{
      btn.disabled = true;
      if(i === q.correct) btn.classList.add('correct');
      if(i === choice && choice !== q.correct) btn.classList.add('wrong');
    });

    if(choice === q.correct){
      state.quizCorrect++;
      addScore(10,'Quiz');
      fb.textContent = '‚úÖ Correct! +10';
      fb.className = 'feedback ok';
    } else {
      fb.textContent = `‚ùå Wrong. Correct: ${q.options[q.correct]}`;
      fb.className = 'feedback bad';
    }

    document.getElementById('quizNext').disabled = false;
  }

  function nextQuiz(){
    if(state.quizIndex < quizData.length - 1){
      state.quizIndex++;
      renderQuiz();
      return;
    }

    const passed = state.quizCorrect >= 2;
    const fb = document.getElementById('quizFeedback');
    if(passed){
      addStar('Quiz');
      addScore(20,'Quiz');
      fb.textContent = `üèÜ Quiz cleared (${state.quizCorrect}/3). Star earned.`;
      fb.className = 'feedback ok';
    } else {
      fb.textContent = `‚ö†Ô∏è Quiz result ${state.quizCorrect}/3. Need 2/3 for a star.`;
      fb.className = 'feedback bad';
    }
    document.getElementById('quizNext').disabled = true;
  }

  function restartQuiz(){
    state.quizIndex = 0;
    state.quizCorrect = 0;
    renderQuiz();
  }

  // Matching pairs app
  function setupPairs(){
    const deck = [];
    pairBase.forEach((pair,idx)=>{
      const [a,b] = pair.split('|');
      deck.push({id:`${idx}a`,pair:idx,text:a,open:false,matched:false});
      deck.push({id:`${idx}b`,pair:idx,text:b,open:false,matched:false});
    });
    state.pairsDeck = deck.sort(()=>Math.random()-0.5);
    state.pairsOpen = [];
    document.getElementById('pairsFeedback').textContent = '';
    drawPairs();
  }

  function drawPairs(){
    const board = document.getElementById('pairsBoard');
    board.innerHTML = state.pairsDeck.map((card,i)=>`<button class="pairCard ${card.open?'open':''} ${card.matched?'matched':''}" data-i="${i}">${(card.open||card.matched)?card.text:'?'}</button>`).join('');
    board.querySelectorAll('button').forEach(btn=>btn.addEventListener('click',()=>flipPair(Number(btn.dataset.i))));
  }

  function flipPair(i){
    const c = state.pairsDeck[i];
    if(!c || c.open || c.matched || state.pairsOpen.length===2) return;

    c.open = true;
    state.pairsOpen.push(c);
    drawPairs();

    if(state.pairsOpen.length===2){
      const [a,b] = state.pairsOpen;
      if(a.pair===b.pair){
        a.matched = true;
        b.matched = true;
        state.pairsOpen = [];
        addScore(12,'Pairs');
        document.getElementById('pairsFeedback').textContent = '‚úÖ Match! +12';
        document.getElementById('pairsFeedback').className = 'feedback ok';
        if(state.pairsDeck.every(x=>x.matched)){
          addStar('Pairs');
          document.getElementById('pairsFeedback').textContent = 'üèÜ All pairs found. Star earned.';
        }
      } else {
        document.getElementById('pairsFeedback').textContent = '‚ùå Not a pair.';
        document.getElementById('pairsFeedback').className = 'feedback bad';
        setTimeout(()=>{
          a.open = false;
          b.open = false;
          state.pairsOpen = [];
          drawPairs();
        },600);
      }
    }
  }

  // Wheel app
  function spinWheel(){
    const task = wheelTasks[Math.floor(Math.random()*wheelTasks.length)];
    document.getElementById('wheelResult').textContent = task;
    document.getElementById('wheelFeedback').textContent = '‚úÖ Challenge generated. +5 points';
    document.getElementById('wheelFeedback').className = 'feedback ok';
    addScore(5,'Wheel');
  }

  // Anagram app
  function renderAnagram(){
    const item = anagrams[state.anagramIndex];
    document.getElementById('anagramWord').textContent = item.scrambled;
    document.getElementById('anagramInput').value = '';
    document.getElementById('anagramFeedback').textContent = '';
    document.getElementById('anagramFeedback').className = 'feedback';
  }

  function checkAnagram(){
    const item = anagrams[state.anagramIndex];
    const input = document.getElementById('anagramInput').value.trim().toUpperCase();
    const fb = document.getElementById('anagramFeedback');

    if(!input){
      fb.textContent = 'Type an answer first.';
      fb.className = 'feedback bad';
      return;
    }

    if(input === item.answer){
      fb.textContent = '‚úÖ Correct anagram! +10';
      fb.className = 'feedback ok';
      addScore(10,'Anagram');
      if(item.answer === 'CHATBOT') addStar('Anagram');
    } else {
      fb.textContent = `‚ùå Not correct. Try again.`;
      fb.className = 'feedback bad';
    }
  }

  function nextAnagram(){
    state.anagramIndex = (state.anagramIndex + 1) % anagrams.length;
    renderAnagram();
  }

  function resetAll(){
    localStorage.removeItem('pitGamesV4');
    state.score = 0;
    state.stars = 0;
    state.best = '-';
    state.quizIndex = 0;
    state.quizCorrect = 0;
    state.anagramIndex = 0;
    hud();
    restartQuiz();
    setupPairs();
    renderAnagram();
    document.getElementById('wheelResult').textContent = 'Press SPIN to get a challenge.';
    document.getElementById('wheelFeedback').textContent = '';
    tip('Reset complete. Choose an app and play.');
  }

  // events
  document.querySelectorAll('.gameBtn').forEach(btn=>{
    btn.addEventListener('click',()=>{
      activatePanel(btn.dataset.panel);
      tip(`Now using ${btn.textContent.split('\n')[0].trim()}.`);
    });
  });
function renderGuacamole(){
  const x=randomFrom(QUESTION_BANK.grammar);
  renderMCQ('guacamole',`Guacamole [U${x.unit}] Whack the correct grammar mole!`,x.o,x.c,()=>{addStar('guacamole');});
}

  document.getElementById('quizNext').addEventListener('click', nextQuiz);
  document.getElementById('quizRestart').addEventListener('click', restartQuiz);
  document.getElementById('pairsRestart').addEventListener('click', setupPairs);
  document.getElementById('wheelSpin').addEventListener('click', spinWheel);
  document.getElementById('anagramCheck').addEventListener('click', checkAnagram);
  document.getElementById('anagramNext').addEventListener('click', nextAnagram);
  document.getElementById('pauseBtn').addEventListener('click', ()=>{ state.paused = !state.paused; tip(state.paused ? 'Timer paused.' : 'Timer resumed.'); });
  document.getElementById('resetBtn').addEventListener('click', resetAll);
pauseBtn.onclick=()=>{state.paused=!state.paused;};
resetBtn.onclick=()=>{localStorage.removeItem('gamesStationV1');state.score=0;state.stars=0;state.best='-';state.seconds=0;timer.textContent='00:00';hud();games[state.active].render();};

  // init
  hud();
  restartQuiz();
  setupPairs();
  renderAnagram();
  startTimer();
hud();buildMenu();games[state.active].render();startTimer();
</script>

</body>
</html>
